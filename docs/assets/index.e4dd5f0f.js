var t=Object.defineProperty,e=Object.defineProperties,s=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(e,s,n)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,a=(t,e)=>{for(var s in e||(e={}))o.call(e,s)&&r(t,s,e[s]);if(n)for(var s of n(e))i.call(e,s)&&r(t,s,e[s]);return t},c=(t,n)=>e(t,s(n));import{V as h}from"./vue.87a98c28.js";import{V as d,_ as l,a as u,b as p,c as f,d as g,e as m,f as b,g as y,h as w,i as _,j as v,k,l as x,m as C,n as E,o as S,p as $,q as O,r as T,s as j,t as R,u as N,v as D,w as A,x as P,y as I,z as B,A as L,B as F,C as M,D as q}from"./vuetify.568efa99.js";let W;const U={},V=function(t,e){if(!e)return t();if(void 0===W){const t=document.createElement("link").relList;W=t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(e.map((t=>{if(t in U)return;U[t]=!0;const e=t.endsWith(".css"),s=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${s}`))return;const n=document.createElement("link");return n.rel=e?"stylesheet":W,e||(n.as="script",n.crossOrigin=""),n.href=t,document.head.appendChild(n),e?new Promise(((t,e)=>{n.addEventListener("load",t),n.addEventListener("error",e)})):void 0}))).then((()=>t()))};h.use(d);var G=new d({theme:{options:{variations:!1,customProperties:!0},themes:{light:{background:"#f7f5f5",surface:"#fffdfd",panel:"#f4f2f2",primary:"#ad1625",primary_light:"#e5504d",primary_dark:"#760000",error:"#ec7422",highlight:"#fff5ce"},dark:{background:"#0b0808",surface:"#201d1d",panel:"#262424",primary:"#ad1625",primary_light:"#e5504d",primary_dark:"#760000",error:"#ec7422",highlight:"#716741"}}}});function H(t,e,s,n,o,i,r,a){var c,h="function"==typeof t?t.options:t;if(e&&(h.render=e,h.staticRenderFns=s,h._compiled=!0),n&&(h.functional=!0),i&&(h._scopeId="data-v-"+i),r?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},h._ssrRegister=c):o&&(c=a?function(){o.call(this,(h.functional?this.parent:this).$root.$options.shadowRoot)}:o),c)if(h.functional){h._injectStyles=c;var d=h.render;h.render=function(t,e){return c.call(e),d(t,e)}}else{var l=h.beforeCreate;h.beforeCreate=l?[].concat(l,c):[c]}return{exports:t,options:h}}const K={};var Y=H({name:"Masonry",mounted(){this.resizeBricks();const t=new ResizeObserver((()=>{this.resizeBricks()})).observe(this.$el);t&&(this.ro=()=>t.unobserve(this.$el))},beforeDestroy(){this.ro&&this.ro(),this.ro=void 0},methods:{resizeBrick(t,e,s){const n=t.children[0].clientHeight,o=Math.ceil((n+s)/(e+s)),i="span "+o;o>0&&t.style.gridRowEnd!=i&&(t.style.gridRowEnd="span "+o)},resizeBricks(){const t=window.getComputedStyle(this.$el),e=parseInt(t.getPropertyValue("grid-row-gap")),s=parseInt(t.getPropertyValue("grid-auto-rows"));for(let n of this.$children)this.resizeBrick(n.$el,s,e)}}},(function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"masonry"},[t._t("default")],2)}),[],!1,(function(t){for(let e in K)this[e]=K[e]}),"cbbce480",null,null);Y.options.__file="src/components/masonry.vue";var z=Y.exports;const J={};var X=H({name:"MasonryBrick",props:{cols:{default:1}},computed:{style(){return{"grid-column-end":`span ${this.cols}`}}}},(function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"masonry-brick",style:t.style},[t._t("default")],2)}),[],!1,(function(t){for(let e in J)this[e]=J[e]}),null,null,null);X.options.__file="src/components/masonry-brick.vue";var Q=X.exports;const Z={};var tt=H({name:"DemoSettings",props:{connection:null,config:{type:Object,default:()=>({enabled:!1})}},watch:{"config.enabled":{immediate:!0,handler(t){t?this.connection.start():this.connection.stop()}}},methods:{injectTab(t){this.connection.inject(t)}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("h3",{staticClass:"mb-1"},[t._v("Demo")]),s("p",{staticClass:"mb-2"},[t._v('The demo connection allows various demo tabs to be injected into the dashboard config. If FlexDash starts-up without config they are all injected as a "Welcome to FlexDash".')]),s("p",{staticClass:"mb-2"},[t._v("The individual tabs can also be injected at any later time.")]),s("p",{staticClass:"font-weight-medium mb-2"},[t._v("Available demo tabs:")]),t._l(this.connection.demos,(function(e){return s("p",{key:e,staticClass:"mb-1"},[t._v(" "+t._s(e)+" "),s(l,{attrs:{"x-small":""},on:{click:function(s){return t.injectTab(e)}}},[t._v("Inject")])],1)}))],2)}),[],!1,(function(t){for(let e in Z)this[e]=Z[e]}),null,null,null);tt.options.__file="src/connections/demo-settings.vue";var et=tt.exports;function st(t,e,s){void 0===t&&(t=0),void 0===e&&(e=100),void 0===s&&(s=.1);let n=(e-t)*Math.random()+t,o=0,i=0,r=0;return()=>{function a(){let t;if(o)t=r*i;else{let e;do{e=2*Math.random()-1,r=2*Math.random()-1,i=e*e+r*r}while(i>=1);i=Math.sqrt(-2*Math.log(i)/i),t=e*i}return o^=1,t}let c;do{c=a()}while(n+c<t||n+c>e);return n+=c,h=n,Math.round(h/s)/Math.round(1/s);var h}}function nt(t){return JSON.parse(JSON.stringify(t))}class ot extends Error{constructor(t){return super(t),this.name="StoreError",this}}function it(t,e){let s=t;for(const n of e)if(""==n);else if(Array.isArray(s)){const t=parseInt(n,10);if(Number.isNaN(t))throw new ot(`Array index '${n}' in '${e}' is not an int`);if(t<0||t>=s.length)throw new ot(`Array index '${n}' in '${e}' > ${s.length}`);s=s[t]}else{if("object"!=typeof s)throw new ot(`Level '${n}' of '${e}'' is not traversable: ${typeof s[n]}`);n in s&&void 0!==s[n]||h.set(s,n,{}),s=s[n]}return s}const rt={icon:"rocket-launch",title:""},at={kind:"FixedGrid",title:"",widgets:[]},ct={kind:"Stat",rows:1,cols:1,static:{title:"Stat"},dynamic:{}};let ht=new class{constructor(){return this.root=h.observable({sd:{},$config:{dash:{},tabs:{},grids:{},widgets:{},conn:{}}}),this.sd=this.root.sd,this.config=this.root.$config,this.undo=h.observable({buf:[],at:null}),this}insertData(t,e){let s=t.split("/");if(s=s.filter((t=>t.length>0)),0==s.length)throw new ot("Cannot replace entire hierarchy");if("$config"===t)return Object.keys(e).forEach((t=>{h.set(this.config,t,e[t])})),void console.log("Replaced $config with:",e);"$config"!==s[0]&&s.unshift("sd");const n=s.pop(),o=it(this.root,s);let i;if(Array.isArray(o)){const s=parseInt(n,10);if(Number.isNaN(s))throw new ot(`Array index '${n}' is not a number`);if(s>=0&&s<o.length){if(void 0===e)throw new ot(`Cannot delete array element '${s}' in '${t}'`);i=o[s],h.set(o,s,e)}else{if(s!=o.length)throw new ot(`Array index '${s}' in '${t}' > ${o.length}`);if(void 0===e)throw new ot(`Array index '${s}' in '${t}' >= ${o.length}`);i=void 0,o.push(e)}}else{if("object"!=typeof o)throw new ot(`${t} is neither Array nor Object in server state`);i=o[n],void 0!==e?h.set(o,n,e):delete o[n]}return i}pushUndo(t,e){const s=Date.now(),n=this.undo;if(n.at&&n.buf.length>0&&s-n.at<6e4&&t==n.buf[n.buf.length-1].tagline)console.log("undo coalesce"),n.buf[n.buf.length-1].mutation=[...e,...n.buf[n.buf.length-1].mutation];else for(n.at=s,n.buf.push({tagline:t,mutation:e});n.buf.length>10;)n.buf.shift()}performUndo(){console.log("perform undo");const t=this.undo;if(0==t.buf.length)throw new ot("undo buffer is empty");const e=t.buf.pop();t.at=null,this.qMutation(null,e.mutation)}qMutation(t,e){console.log("queueing mutation",t);let s=[];for(const n of e)s.unshift([n[0],this.insertData("$config/"+n[0],n[1])]);t&&this.pushUndo(t,s);for(const n of e)this.sendMutation(n[0])}sendMutation(t){const e=t.split("/");let s="$config/"+e[0],n=this.config[e[0]];e.length>1&&(s+="/"+e[1],n=n[e[1]]),this.serverSend(s,n)}genId(t,e){let s=null;for(;!s||s in t;)s="00000"+Math.floor(1e4*Math.random()),s=e+s.substring(s.length-5);return s}tabByID(t){const e=this.config.tabs[t];if(e&&e.id==t)return e;throw new ot(`tab ${t} does not exist`)}gridByID(t){const e=this.config.grids[t];if(e&&e.id==t)return e;throw new ot(`grid ${t} does not exist`)}widgetByID(t){const e=this.config.widgets[t];if(e&&e.id==t)return e;throw new ot(`widget ${t} does not exist`)}tabIDByIX(t){const e=this.config.dash.tabs;if(e&&t>=0&&t<e.length)return e[t];throw new ot(`tab #${t} does not exist`)}gridIDByIX(t,e){if("string"==typeof t&&(t=this.tabByID(t)),t&&e>=0&&e<t.grids.length)return t.grids[e];throw new ot(`grid #${e} does not exist in tab ${t.id}`)}widgetIDByIX(t,e){if("string"==typeof t&&(t=this.gridByID(t)),t&&e>=0&&e<t.widgets.length)return t.widgets[e];throw new ot(`widget #${e} does not exist in grid ${t.id}`)}initDash(){if(this.config.dash.title)throw new ot("cannot init a non-empty store");this.insertData("$config/widgets",{}),this.insertData("$config/grids",{g00001:{id:"g00001",kind:"FixedGrid",widgets:[]}}),this.insertData("$config/tabs",{t00001:{id:"t00001",icon:"view-dashboard",grids:["g00001"]}}),this.insertData("$config/dash",{title:"FlexDash",tabs:["t00001"]})}addTab(t){const e=this.genId(this.config.tabs,"t"),s=this.config.dash.tabs.length;if("grid"===t){const t=this.genId(this.config.grids,"g");this.qMutation("add a grid tab",[[`grids/${t}`,c(a({},nt(at)),{id:t})],[`tabs/${e}`,c(a({},nt(rt)),{id:e,grids:[t]})],[`dash/tabs/${s}`,e]])}else{if("iframe"!==t)throw new ot(`unknown tab type ${t}`);this.qMutation("add an iframe tab",[[`tabs/${e}`,c(a({},nt(rt)),{id:e,slot:"a",url:""})],[`dash/tabs/${s}`,e]])}return s}deleteTab(t){const e=this.tabIDByIX(t),s=this.tabByID(e).grids,n=s.map((t=>this.config.grids[t].widgets)).flat();this.qMutation("delete a tab",[["dash/tabs",this.config.dash.tabs.filter(((e,s)=>s!=t))],[`tabs/${e}`,void 0],...s.map((t=>[`grids/${t}`,void 0])),...n.map((t=>[`widgets/${t}`,void 0]))])}updateTab(t,e){this.tabByID(t),this.qMutation(`update tab ${Object.keys(e).join(",")}`,Object.entries(e).map((([e,s])=>[`tabs/${t}/${e}`,s])))}updateDash(t){this.qMutation(`update dash ${Object.keys(t).join(",")}`,Object.entries(t).map((([t,e])=>[`dash/${t}`,e])))}addGrid(t){const e=this.tabByID(t),s=this.genId(this.config.grids,"g"),n=e.grids.length;return this.qMutation("add a grid",[[`grids/${s}`,c(a({},nt(at)),{id:s})],[`tabs/${t}/grids/${n}`,s]]),n}deleteGrid(t,e){const s=this.tabByID(t),n=this.gridIDByIX(s,e),o=this.gridByID(n);this.qMutation("delete a grid",[[`tabs/${t}/grids`,s.grids.filter(((t,s)=>s!=e))],[`grids/${n}`,void 0],...o.widgets.map((t=>[`widgets/${t}`,void 0]))])}updateGrid(t,e){this.gridByID(t),this.qMutation(`update grid ${Object.keys(e).join(",")}`,Object.entries(e).map((([e,s])=>[`grids/${t}/${e}`,s])))}addWidget(t,e){const s=this.gridByID(t),n=this.genId(this.config.widgets,"w"),o=s.widgets.length;return this.qMutation("add a widget",[[`widgets/${n}`,c(a({},nt(ct)),{id:n,kind:e,static:{title:e},dynamic:{}})],[`grids/${t}/widgets/${o}`,n]]),o}deleteWidget(t,e){const s=this.gridByID(t),n=this.widgetIDByIX(s,e);this.qMutation("delete a widget",[[`grids/${t}/widgets`,s.widgets.filter(((t,s)=>s!=e))],[`widgets/${n}`,void 0]])}updateWidget(t,e){this.widgetByID(t),this.qMutation(`update widget ${Object.keys(e).join(",")}`,Object.entries(e).map((([e,s])=>[`widgets/${t}/${e}`,s])))}updateWidgetProp(t,e,s,n){this.widgetByID(t),this.qMutation(`update widget prop ${e}:${s}`,[[`widgets/${t}/${e}/${s}`,n]])}};const dt={"Widget sampler":{tabs:{t0000:{id:"t0000",icon:"dice-multiple",grids:["g0000"]}},grids:{g0000:{id:"g0000",kind:"FixedGrid",widgets:["w0001","w0000","w0003","w0002","w0009","w0006","w0007","w0008","w0010","w0011","w0012","w0013","w0014","w0020","w0021","w0022","w0023","w0024"]}},widgets:{w0001:{kind:"Markdown",id:"w0001",cols:3,rows:5,dynamic:{},static:{title:"",text:'\n# Welcome to FlexDash\n\nYou are seeing the FlexDash demo dashboard. It shows a variety of _widgets_ spread across\nmultiple _tabs_. Each tab can have multiple _grids_ that lay out the widgets and that can be\nrolled up and down.\n\n### Getting started\n\nThe demo dashboard does not connect to any server and instead displays randomly generated data.\nTo connect to a server switch to the next "websock" tab and read the instructions there.\n\nTo edit the dashboard\'s configuration, switch to edit mode using the settings icon at\nthe top-right.\nIn edit mode all the items on the page have a little pencil icon, click on that to\nbring up an editing card. The exception to the pencil icon are the grid, which have a\ntoolbar across the page.\n\nAll editing is instantaneous while the dashboard remains live. If you make\na mistake, use the undo button at the top right. Unless you hook up a server connection\nand configure the server to persist the config, all changes you make here are in browser\nmemory only and are lost when you refresh the page.\n'}},w0000:{kind:"Stat",id:"w0000",static:{title:"Bedroom",value:"cold",unit:"F"},dynamic:{value:"$demo/bedroom"},rows:1,cols:1},w0002:{kind:"Stat",id:"w0002",static:{title:"Bedroom",unit:"F"},dynamic:{value:"$demo/bedroom"},rows:1,cols:1},w0003:{kind:"Gauge",id:"w0003",static:{title:"Hilltop",value:50,arc:270,center:!0,unit:"F",needle_color:"red",min:30},dynamic:{value:"$demo/hilltop"},rows:2,cols:2},w0006:{kind:"Gauge",id:"w0006",static:{title:"Kitchen",color:"lightblue",arc:90,unit:"F",min:0},dynamic:{value:"$demo/kitchen"},rows:1,cols:1},w0007:{kind:"Toggle",id:"w0007",static:{title:"light",off_value:"0",on_value:"ON",color:"secondary",value:"ON"},dynamic:{_output:"light",value:"light"},rows:1,cols:1},w0008:{kind:"PushButton",id:"w0008",static:{title:"launch",color:"secondary",output_value:"ON",icon:"rocket-launch",tooltip:"Next stop: Mars!"},dynamic:{_output:"light"},rows:1,cols:1},w0009:{kind:"PushButton",id:"w0009",static:{title:"",icon:"watering-can"},dynamic:{},rows:1,cols:1},w0010:{kind:"Gauge",id:"w0010",static:{title:"Kitchen",arc:180,base_color:"lightgreen",color:"blue",unit:"F",radius:90,needle_color:"white"},dynamic:{value:"$demo/kitchen"},rows:1,cols:1},w0011:{kind:"Sparkchart",id:"w0011",static:{title:"Hilltop",color:"green",line_width:4,fill:!0},dynamic:{value:"$demo/hilltop"},rows:1,cols:1},w0012:{kind:"Sparkchart",id:"w0012",static:{title:"Hilltop",bars:!0},dynamic:{value:"$demo/hilltop"},rows:1,cols:1},w0013:{kind:"Sparkchart",id:"w0013",static:{title:"Kitchen"},dynamic:{value:"$demo/kitchen"},rows:1,cols:2},w0014:{kind:"TimePlot",id:"w0014",static:{title:"Temperatures",left_unit:"°F",left_decimals:0,labels:Array.from({length:10},((t,e)=>"Sensor "+(e+1)))},dynamic:{data:"$demo/plot"},rows:4,cols:4},w0020:{kind:"RandomValue",id:"w0020",output:"$demo/kitchen",static:{title:"Rnd Kitchen",min:50,max:90},dynamic:{},rows:1,cols:1},w0021:{kind:"RandomValue",id:"w0021",output:"$demo/hilltop",static:{title:"Rnd Hilltop",min:20,max:90,seconds:6},dynamic:{},rows:1,cols:1},w0022:{kind:"RandomValue",id:"w0022",output:"$demo/bedroom",static:{title:"Rnd Bedroom",min:50,max:90,seconds:4},dynamic:{},rows:1,cols:1},w0023:{kind:"RandomArray",id:"w0023",output:"$demo/plot",static:{title:"Rnd Plot",min:50,max:90,seconds:7,length:11},dynamic:{},rows:1,cols:1},w0024:{kind:"IFrame",id:"w0024",static:{title:"",url:"https://user-images.githubusercontent.com/19274367/45430032-b6a5a180-b6a4-11e8-9645-a0497ef044f3.png"},rows:2,cols:2}}},"Socket.IO demo":{tabs:{t0005:{id:"t0005",title:"sockio",icon:"lightning-bolt",grids:["g0005"]}},grids:{g0005:{id:"g0005",kind:"FixedGrid",widgets:["w0030","w0031","w0032","w0033"]}},widgets:{w0030:{kind:"Markdown",id:"w0030",cols:4,rows:5,dynamic:{},static:{title:"",text:'# Socket.io server connection\n\nFlexDash can establish a socket.io connection to a server. This connection allows:\n- sending data from the server to FlexDash for display\n- sending user input from FlexDash to the server\n- persisting the FlexDash configuration on the server\n\nThe socket.io connection is intended to be used with Node-RED but isn\'t really specific\nto Node-RED. The easiest way to get started is to install node-red-contrib-flexdash in Node-RED,\nload the [demo flow](/flexdash/misc/sio-demo-flow.json) and to open the network\nconfiguration panel here using the network icon in the upper-right corner and configure the\nsocket.io connection to connect to Node-RED.\n\n### 1. Installation\n\nChoose your preferred method for installing nodes in Node-RED. The current package version is\n0.1.1 :-). The package is on npmjs: https://www.npmjs.com/package/node-red-contrib-flexdash\n\nCreate a new flow with the demo set-up: [demo flow](/flexdash/misc/sio-demo-flow.json).\nYou should check the options for the flexdash config node, the defaults should work...\nThe flow should look as follows:\n\n![flexdash demo flow](/flexdash/img/sio-demo-flow.png)\n\n### 2. Connect the dashboard to Node-RED\n\nOpen the network configuration in FlexDash and point the socket.io connection at your Node-RED\nserver. Don\'t forget the port with the hostname, e.g. `localhost:1880`. You should end up with\na green OK after the socket.io heading. In case of failure, check the browser\'s developer console\nfor error messages (yes, there\'s room for improvement here).\n\n### 3. Try the test nodes\n\nOnce connected you can try out the test nodes: hitting the inject node should show "hello" in\nthe stat widget in the dashboard. Flipping the light switch in the dashboard widget should output\na message in the debug node in NR and the round-trip message should change the switch text as well\nas the adjoining stat node\'s text.\n\n### 4. Switch from demo to real dashboard\n\nWhen you brought up the dashboard it had no connection and established a "demo connection".\nThe socket.io connection you added is only used as additional method for sending/receiving data.\nThe dashboard configuration is not saved anywhere! So if you reload the browser you\'re back to\ndemo square one.\n\nTo work with a persistent configuration two things are necessary:\n1. load the dashboard from a real network connection that supports config saving\n2. ensure that the server at the other end actually persists the config\n\nFor step 1 the dashboard needs to be loaded with a query string that configures the server\nconnection from the get-go. For socket.io use a query string of the form\n`sio=http://example.com:1234/path`, which, assuming you\'re running Node-Red locally\nmight look as follows:\n\n  https://tve.github.io/flexdash/?sio=http://localhost:1880/io/flexdash/\n\nNote that you can also use https for the socket.io and that the `/io/flexdash` path\nmust match the flexdash configuration node options in Node-RED.\n\nIf you use a URL as above, you should see the dashboard connect to your server and not show\nthe demo stuff anymore. It\'s now your own config, which starts out empty. You can, however,\nadd the demo tabs back using the inject buttons in the demo section of the server connections\nsettings dialog.\n\nFor step 2, i.e., to ensure that the server persists the dashboard configuration you may need to\nedit the Node-RED settings.js. Specifically, you need a context store that uses the local filesystem instead of just memory. See the guide on\n[working with context storage](https://nodered.org/docs/user-guide/context) for background, but the\nshort is to locate the "contextStorage" setting in the `settings.js` and enable a context\nstore with `localfilesystem`. Mine looks as follows, giving me a default memory context store\nand an optional persistent one:\n\n    contextStorage: {\n        default: { module: "memory" },\n        persistent: { module: "localfilesystem" }\n    },\n\nYou then need to edit the FlexDash configuration node and set the context store name\n("persistent" in my case), unless you opted to make the default context store backed\nby the filesystem.\n\nAfter editing the settings you will have to restart Node-RED.\n(I wish there was an easier way to make all this happen.)\n\nOnce all the above is done do test the result! An easy way is to pull up the empty dashboard\nand inject one of the demo tabs. Then reload the browser and it should come right back with\nthe dashboard that has the added demo tab. Then restart Node-RED and reload the browser again\nand you should still get the same dashboard with the added demo tab. If the demo tab is gone\nthe localfilesystem context store didn\'t work.\n\nAt this point any changes you make to the dashboard are persistent. You can inspect the\nactual config in the Node-RED admin UI using the context store panel under the global\ncontext variables.\n'}},w0031:{kind:"Stat",id:"w0031",static:{title:"ws_data",unit:""},dynamic:{value:"ws_data"},rows:1,cols:1},w0032:{kind:"Toggle",id:"w0032",static:{title:"Light switch",on_value:"ON",off_value:"OFF"},dynamic:{value:"light"},output:"switch",rows:1,cols:1},w0033:{kind:"Stat",id:"w0033",static:{title:"Light",unit:""},dynamic:{value:"light"},rows:1,cols:1}}},"Websocket demo":{tabs:{t0001:{id:"t0001",title:"websock",icon:"resistor-nodes",grids:["g0001"]}},grids:{g0001:{id:"g0001",kind:"FixedGrid",widgets:["w0015","w0016","w0017","w0018","w0019"]}},widgets:{w0015:{kind:"Markdown",id:"w0015",cols:4,rows:5,dynamic:{},static:{title:"",text:'# Websocket server connection\n\nFlexDash can establish a simple websocket connection to a server. This connection allows:\n- sending data from the server to FlexDash for display\n- sending user input from FlexDash to the server\n- persisting the FlexDash configuration on the server\n\nThe communication protocol uses very simple topic + payload messages,\nsuch as `{"topic":"foo", "payload":199}`,\nwhere the topic establishes the binding between the data and a widget in FlexDash.\n\n### Connecting to Node-Red\n\nBefore connecting to Node-Red the latter needs two nodes to send websocket data:\n\n1- A `websocket-out` node to send data configured as follows:\n- the type set to "listen on"\n- the path set to "Add new websocket listener" and, using the pencil button, the listener\'s path set to `/ws/flexdash` and "send/receive" to "entire message".\n\n2- An inject node with the topic set to `ws_data` and the payload set to some short string like\n"hello" or some number\n- the inject node connected to the websocket-out node\n\nThis should look something like this: ![inject into websocket](/flexdash/img/howto-ws-2nodes.png)\n\nNow deploy those two nodes and open the connection editing panel here in FlexDash using the\nnetwork icon at the top-right. Set the websocket address to the Node-Red server\'s hostname,\nport, and a path of `/ws/flexdash` (this needs to match the path set in the websocket listener\nin Node-Red). The address should look something like `ws://localhost:1880/ws/flexdash`.\nThen enable the websocket and the status should shortly change to _connected_.\n\nOnce the connection is established, hit the inject node button and the value set in its payload\nwill show up in the stats widget to the right of this text widget. It is now possible to wire\nadditional nodes into the `websocket-out` to send values to other widgets. It is also possible\nto instantiate additional `websocket-out` nodes if that is more convenient.\n\nTo bind new data values to a new widget, ensure that the `msg.topic` of those values is unique,\nadd the desired widget to the grid (turn on _edit mode_ using the settings menu\nat the top-right), and set the widget\'s input (typically _value_) to be linked to the topic.\n\n### Sending user input to Node-Red\n\nSending user input from a toggle widget or a push button widget to Node-Red is simple as well:\n- Instantiate a `websocket-in` node and configure it to use the same "listen on" path as the `websocket-out`.\n- Add a `switch` node set to filter the desired topic, switch" in this example.\n- Hook up a debug node to see the messages or, alternatively, add a `change` node to set the topic to "light" and feed that into a `websocket-out`, this second option might look like this:\n\n![feed switch into light](/flexdash/img/howto-ws-inout.png)\n\nIf you use the "switch" and "light" topics the toggle node on this page should control the value\nof the stat node via Node-Red.\n\nThe websocket demo flows mentioned above are available\nfor [download](/flexdash/misc/ws-demo-flow.json).\n'}},w0016:{kind:"Stat",id:"w0016",static:{title:"ws_data",unit:""},dynamic:{value:"ws_data"},rows:1,cols:1},w0017:{kind:"Toggle",id:"w0017",static:{title:"Light switch",on_value:"ON",off_value:"OFF"},dynamic:{value:"light"},output:"switch",rows:1,cols:1},w0018:{kind:"Stat",id:"w0018",static:{title:"Light",unit:""},dynamic:{value:"light"},rows:1,cols:1},w0019:{kind:"Markdown",id:"w0019",cols:4,rows:4,dynamic:{},static:{title:"",text:"# Saving the config\n\nTo really use the dashboard its configuration needs to be saved somewhere, otherwise it\ncomes up with the demo config every time, which is not much fun.\nTo save the dashboard two things are necessary:\n- the dashboard needs to be launched such that it immediately connects to the server that holds the config\n- the server needs to have some code to save config changes and send the config when the dashboard starts up\n\n### Connecting via websocket at launch\n\nTo connect to a server at launch the websocket address must be encoded in the URL\nquery string using a `ws` query string parameter,\nfor example, assuming the dashboard is launched from github and should connect to\na local Node-RED instance, the URL might look as follows:\n\nhttps://tve.github.io/flexdash/?ws=ws://localhost:1880/ws/flexdash\n\nA simple method for getting this URL is to configure and connect the websocket in the\ndashboard's network configuration and then use the `reload` button at the bottom of\nthe config panel.\n\nNote that it is further possible to jump straight to a specific tab by adding the tab\nname or the tab's icon name as anchor, for example:\n\nhttps://tve.github.io/flexdash/?ws=ws://localhost:1880/ws/flexdash#websock\n\n### Saving the dashboard config on the server end\n\nThe dashboard saves the configuration by sending messages to a topic starting with `$config`\nand a payload consisting of a JSON structure or `null` in order to prune the config.\n\n"}}}}};class lt{constructor(t){return this.name="demo",this.data=h.observable({status:"off"}),this.demos=Object.keys(dt),this}start(){this.data.status="ok",Object.keys(dt).forEach((t=>this.inject(t)))}inject(t){if(!(t in dt))return;if(!ht.config.dash.tabs){const t=ht.config.conn||{};console.log("Demo injecting $config"),ht.qMutation("demo init",[["dash",{title:"FlexDash",tabs:[]}],["tabs",{}],["grids",{}],["widgets",{}],["conn",t]])}const e=Object.keys(dt[t].tabs).filter((t=>!(t in ht.config.tabs)));if(0==e.length)return;const s=[["dash/tabs",ht.config.dash.tabs.concat(e)]];for(let n in dt[t])for(let e in dt[t][n])s.push([`${n}/${e}`,dt[t][n][e]]);ht.qMutation(`demo tab ${t}`,s)}stop(){this.data.status="off"}serverSend(t,e){}}const ut={};var pt=H({name:"WebsockSettings",props:{connection:null,config:{type:Object,default:()=>({enabled:!1,config:!1,address:""})}},computed:{status_txt(){return this.config.enabled&&this.connection?this.connection.data.status_txt||this.connection.data.status:"disabled"},status_color(){return this.config.enabled&&this.connection?"ok"==this.connection.data.status?"success":"bad"==this.connection.data.status?"error":"grey":"grey"},disable(){return!this.connection}},watch:{"config.enabled":{immediate:!0,handler(t){t?(console.log("WS now enabled, addr:",this.config.address),!0===this.validateAddress(this.config.address)&&this.connection.start(this.config.address,this.config.config)):(console.log("WS now disabled"),this.connection.stop())}}},methods:{handleAddress(t){this.config.address=t,this.$emit("change",this.config),this.config.enabled&&(console.log("WS: address changed, reconnecting"),this.connection.stop(),!0===this.validateAddress(this.config.address)&&this.connection.start(this.config.address,this.config.config))},validateAddress:t=>t.match(/^(ws|http)s?:[/][/]/)?!!t.match(/^(ws|http)s?:[/][/][^/]+\//)||"address must contain hostname and path":"address must start with ws:// or wss://",reload(){window.location.search="ws="+this.config.address}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticStyle:{width:"100%",display:"flex","justify-content":"space-between","align-items":"baseline"}},[s("h3",[t._v("Websocket")]),s(u,{attrs:{small:"",color:t.status_color}},[t._v(t._s(t.status_txt))])],1),t._m(0),t._m(1),s(p,{attrs:{label:"websocket server address","persistent-hint":"",clearable:"",value:t.config.address,rules:[t.validateAddress],hint:"wss://server.example.com/mydash, ws://localhost:1880/ws/fd"},on:{change:t.handleAddress}}),s(f,{attrs:{"hide-details":"",label:"enable",disabled:t.disable,"input-value":t.config.enabled},on:{change:function(e){t.config.enabled=e}}}),s("div",{staticClass:"mt-3"},[t._v(" Reload the dashboard from this server (looses current config): "),s(l,{attrs:{disabled:"OK"!=t.status_txt,"x-small":""},on:{click:function(e){return t.reload()}}},[t._v("reload")])],1)],1)}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("The websocket uses JSON messages of the form "),s("code",[t._v('{"topic":"...", "payload":...}')]),t._v(". Messages for the dashboard configuration have topics starting with "),s("code",[t._v("$config/")]),t._v(". ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("To load/save the config over websocket load the dashboard with a query string of the form "),s("code",[t._v("?ws=<websocket-url>")]),t._v(".")])}],!1,(function(t){for(let e in ut)this[e]=ut[e]}),null,null,null);pt.options.__file="src/connections/websock-settings.vue";var ft=pt.exports,gt=function(t,e){return(gt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(t,e)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function mt(t,e){function s(){this.constructor=t}gt(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}function bt(t,e){var s="function"==typeof Symbol&&t[Symbol.iterator];if(!s)return t;var n,o,i=s.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)r.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(s=i.return)&&s.call(i)}finally{if(o)throw o.error}}return r}function yt(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(bt(arguments[e]));return t}var wt=function(t,e){this.target=e,this.type=t},_t=function(t){function e(e,s){var n=t.call(this,"error",s)||this;return n.message=e.message,n.error=e,n}return mt(e,t),e}(wt),vt=function(t){function e(e,s,n){void 0===e&&(e=1e3),void 0===s&&(s="");var o=t.call(this,"close",n)||this;return o.wasClean=!0,o.code=e,o.reason=s,o}return mt(e,t),e}(wt),kt={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},xt=function(){function t(t,e,s){var n=this;void 0===s&&(s={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(t){n._debug("open event");var e=n._options.minUptime,s=void 0===e?kt.minUptime:e;clearTimeout(n._connectTimeout),n._uptimeTimeout=setTimeout((function(){return n._acceptOpen()}),s),n._ws.binaryType=n._binaryType,n._messageQueue.forEach((function(t){return n._ws.send(t)})),n._messageQueue=[],n.onopen&&n.onopen(t),n._listeners.open.forEach((function(e){return n._callEventListener(t,e)}))},this._handleMessage=function(t){n._debug("message event"),n.onmessage&&n.onmessage(t),n._listeners.message.forEach((function(e){return n._callEventListener(t,e)}))},this._handleError=function(t){n._debug("error event",t.message),n._disconnect(void 0,"TIMEOUT"===t.message?"timeout":void 0),n.onerror&&n.onerror(t),n._debug("exec error listeners"),n._listeners.error.forEach((function(e){return n._callEventListener(t,e)})),n._connect()},this._handleClose=function(t){n._debug("close event"),n._clearTimeouts(),n._shouldReconnect&&n._connect(),n.onclose&&n.onclose(t),n._listeners.close.forEach((function(e){return n._callEventListener(t,e)}))},this._url=t,this._protocols=e,this._options=s,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(t,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CONNECTING",{get:function(){return t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OPEN",{get:function(){return t.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSING",{get:function(){return t.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSED",{get:function(){return t.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){return this._messageQueue.reduce((function(t,e){return"string"==typeof e?t+=e.length:e instanceof Blob?t+=e.size:t+=e.byteLength,t}),0)+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?t.CLOSED:t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),t.prototype.close=function(t,e){void 0===t&&(t=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),this._ws?this._ws.readyState!==this.CLOSED?this._ws.close(t,e):this._debug("close: already closed"):this._debug("close enqueued: no ws instance")},t.prototype.reconnect=function(t,e){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED?(this._disconnect(t,e),this._connect()):this._connect()},t.prototype.send=function(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{var e=this._options.maxEnqueuedMessages,s=void 0===e?kt.maxEnqueuedMessages:e;this._messageQueue.length<s&&(this._debug("enqueue",t),this._messageQueue.push(t))}},t.prototype.addEventListener=function(t,e){this._listeners[t]&&this._listeners[t].push(e)},t.prototype.dispatchEvent=function(t){var e,s,n=this._listeners[t.type];if(n)try{for(var o=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],s=0;return e?e.call(t):{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}}}(n),i=o.next();!i.done;i=o.next()){var r=i.value;this._callEventListener(t,r)}}catch(a){e={error:a}}finally{try{i&&!i.done&&(s=o.return)&&s.call(o)}finally{if(e)throw e.error}}return!0},t.prototype.removeEventListener=function(t,e){this._listeners[t]&&(this._listeners[t]=this._listeners[t].filter((function(t){return t!==e})))},t.prototype._debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._options.debug&&console.log.apply(console,yt(["RWS>"],t))},t.prototype._getNextDelay=function(){var t=this._options,e=t.reconnectionDelayGrowFactor,s=void 0===e?kt.reconnectionDelayGrowFactor:e,n=t.minReconnectionDelay,o=void 0===n?kt.minReconnectionDelay:n,i=t.maxReconnectionDelay,r=void 0===i?kt.maxReconnectionDelay:i,a=0;return this._retryCount>0&&(a=o*Math.pow(s,this._retryCount-1))>r&&(a=r),this._debug("next delay",a),a},t.prototype._wait=function(){var t=this;return new Promise((function(e){setTimeout(e,t._getNextDelay())}))},t.prototype._getNextUrl=function(t){if("string"==typeof t)return Promise.resolve(t);if("function"==typeof t){var e=t();if("string"==typeof e)return Promise.resolve(e);if(e.then)return e}throw Error("Invalid URL")},t.prototype._connect=function(){var t=this;if(!this._connectLock&&this._shouldReconnect){this._connectLock=!0;var e=this._options,s=e.maxRetries,n=void 0===s?kt.maxRetries:s,o=e.connectionTimeout,i=void 0===o?kt.connectionTimeout:o,r=e.WebSocket,a=void 0===r?function(){if("undefined"!=typeof WebSocket)return WebSocket}():r;if(this._retryCount>=n)this._debug("max retries reached",this._retryCount,">=",n);else{if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),void 0===(c=a)||!c||2!==c.CLOSING)throw Error("No valid WebSocket class provided");var c;this._wait().then((function(){return t._getNextUrl(t._url)})).then((function(e){t._closeCalled||(t._debug("connect",{url:e,protocols:t._protocols}),t._ws=t._protocols?new a(e,t._protocols):new a(e),t._ws.binaryType=t._binaryType,t._connectLock=!1,t._addListeners(),t._connectTimeout=setTimeout((function(){return t._handleTimeout()}),i))}))}}},t.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new _t(Error("TIMEOUT"),this))},t.prototype._disconnect=function(t,e){if(void 0===t&&(t=1e3),this._clearTimeouts(),this._ws){this._removeListeners();try{this._ws.close(t,e),this._handleClose(new vt(t,e,this))}catch(s){}}},t.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},t.prototype._callEventListener=function(t,e){"handleEvent"in e?e.handleEvent(t):e(t)},t.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},t.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},t.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},t}();const Ct=["connecting","connected","closing","closed"];class Et{constructor(t){return this.storeInsert=t,this.rws=null,this.checker=null,this.first_connect=!0,this.get_config=!1,this.data=h.observable({last_msg:{topic:null,payload:null},status:"off",status_txt:"off"}),this}start(t,e){console.log("WS: connecting to",t),this.get_config=e,this.data.status="bad",this.rws=new xt(t,[],{debug:!1,startClosed:!0}),this.rws.addEventListener("open",(()=>this.onOpen())),this.rws.addEventListener("close",(()=>this.onClose())),this.rws.addEventListener("message",(t=>this.onMessage(t))),this.rws.addEventListener("error",(t=>this.onError(t))),this.rws.reconnect()}setStatus(){null===this.rws?(this.data.status="off",this.data.status_txt="off"):3==this.rws.readyState?this.data.status="err":1==this.rws.readyState&&0==this.rws.bufferedAmount?(this.data.status="ok",this.data.status_txt="OK"):(this.data.status="bad",this.data.status_txt=`${Ct[this.rws.readyState]}, ${this.rws.bufferedAmount} queued`)}stop(){this.rws&&(console.log("WS: closing"),this.rws.close()),this.rws=null,this.setStatus()}onOpen(){console.log("WS opened"),this.setStatus();const t={topic:"$ctrl",payload:this.get_config&&this.first_connect?"start":"continue"};this.rws.send(JSON.stringify(t)),this.first_connect=!1}onClose(){console.log("WS closed"),this.data.status=this.rws?"bad":"off"}onMessage(t){let e;try{e=JSON.parse(t.data)}catch(s){return void console.log("WS rx:",s)}"object"==typeof e&&"string"==typeof e.topic&&void 0!==e.payload?(console.log("WS rx:",e),this.storeInsert(e.topic,e.payload),this.setStatus()):console.log("WS rx: message is missing topic and/or payload",e)}onError(t){console.log("WS error:",t.message||" ... no details"),this.data.status_txt=t.message?`error: ${t.message}`:"error"}serverSend(t,e){this.rws&&(this.rws.send(JSON.stringify({topic:t,payload:e})),this.rws.bufferedAmount>0&&null===this.checker&&(this.checker=window.setInterval((()=>{this.setStatus(),0===this.rws.bufferedAmount&&(window.clearInterval(this.checker),this.checker=null)}),1e3)))}}const St={};var $t=H({name:"SockioSettings",props:{connection:null,config:{type:Object,default:()=>({enabled:!1,hostname:"",path:"",tls:!0})}},created(){if(this.config.address){const t=this.config.address.match(/^(https?|wss?):\/\/([^/]+)(\/.*)/);4==t.length&&(this.config.hostname=t[2],this.config.path=t[3],this.config.tls="https"==t[1]||"wss"==t[1],delete this.config.address,this.$emit("change",JSON.parse(JSON.stringify(this.config))))}else this.config.path||(this.config.path="/io/flexdash/");this.config.enabled&&!0===this.validateHostname(this.config.hostname)&&this.connection.start(this.config)},computed:{status_txt(){return this.config.enabled&&this.connection?this.connection.data.status_txt||this.connection.data.status:"disabled"},status_color(){return this.config.enabled&&this.connection?"ok"==this.connection.data.status?"success":"bad"==this.connection.data.status?"error":"grey":"grey"},disable(){return!this.connection}},watch:{"config.enabled"(t){t?(console.log("SIO now enabled, hostname:",this.config.hostname),!0===this.validateHostname(this.config.hostname)&&this.connection.start(this.config)):(console.log("SIO now disabled"),this.connection.stop())}},methods:{reconnect(t){console.log("SIO:",t,"changed, reconnecting"),this.connection.stop(),!0===this.validateHostname(this.config.hostname)&&!0===this.validatePath(this.config.path)&&this.connection.start(this.config)},handleHostname(t){this.config.hostname=t,this.$emit("change",this.config),this.config.enabled&&this.reconnect("hostname")},handlePath(t){this.config.path=t,this.$emit("change",this.config),this.config.enabled&&this.reconnect("path")},handleTls(t){this.config.tls=t,this.$emit("change",this.config),this.config.enabled&&this.reconnect("TLS")},validateHostname:t=>!!t.match(/^[^/\s:'"]+(:[0-9]+)?$/)||"only hostname:port",validatePath:t=>!!t.match(/^\//)||"path must start with /",reload(){window.location.search="sio="+this.config.address}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticStyle:{width:"100%",display:"flex","justify-content":"space-between","align-items":"baseline"}},[s("h3",[t._v("Socket.io")]),s(u,{attrs:{small:"",color:t.status_color}},[t._v(t._s(t.status_txt))])],1),t._m(0),t._m(1),s(p,{attrs:{label:"socket.io server hostname:port","persistent-hint":"",clearable:"",value:t.config.hostname,rules:[t.validateHostname],hint:"server.example.com, localhost:1880"},on:{change:t.handleHostname}}),s(p,{staticClass:"mt-2",attrs:{label:"socket.io path","persistent-hint":"",clearable:"",value:t.config.path,rules:[t.validatePath],hint:"webserver path for socket.io, typ /io/flexdash"},on:{change:t.handlePath}}),s(f,{attrs:{"hide-details":"",label:"use https/wss","input-value":t.config.tls},on:{change:t.handleTls}}),s(f,{staticClass:"mt-3",attrs:{"hide-details":"",label:"enable",disabled:t.disable,"input-value":t.config.enabled},on:{change:function(e){t.config.enabled=e}}}),s("div",{staticClass:"mt-3"},[t._v(" Reload the dashboard from this server (looses current config): "),s(l,{attrs:{disabled:"OK"!=t.status_txt,"x-small":""},on:{click:function(e){return t.reload()}}},[t._v("reload")])],1)],1)}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("Socket.io uses a `flexdash` namespace and sends `msg` events with a `topic` and a `payload` argument. Messages for the dashboard configuration have topics starting with "),s("code",[t._v("$config/")]),t._v(". ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("To load/save the config over socket.io load FlexDash with a query string of the form "),s("code",[t._v("?sio=<socket-io-url>")]),t._v(".")])}],!1,(function(t){for(let e in St)this[e]=St[e]}),null,null,null);$t.options.__file="src/connections/sockio-settings.vue";var Ot=$t.exports;function Tt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var jt={exports:{}},Rt={},Nt=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Dt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],At=function(t){var e=t,s=t.indexOf("["),n=t.indexOf("]");-1!=s&&-1!=n&&(t=t.substring(0,s)+t.substring(s,n).replace(/:/g,";")+t.substring(n,t.length));for(var o,i,r=Nt.exec(t||""),a={},c=14;c--;)a[Dt[c]]=r[c]||"";return-1!=s&&-1!=n&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(t,e){var s=/\/{2,9}/g,n=e.replace(s,"/").split("/");"/"!=e.substr(0,1)&&0!==e.length||n.splice(0,1);"/"==e.substr(e.length-1,1)&&n.splice(n.length-1,1);return n}(0,a.path),a.queryKey=(o=a.query,i={},o.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,s){e&&(i[e]=s)})),i),a};var Pt={exports:{}},It=1e3,Bt=60*It,Lt=60*Bt,Ft=24*Lt,Mt=7*Ft,qt=365.25*Ft,Wt=function(t,e){e=e||{};var s=typeof t;if("string"===s&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var s=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return s*qt;case"weeks":case"week":case"w":return s*Mt;case"days":case"day":case"d":return s*Ft;case"hours":case"hour":case"hrs":case"hr":case"h":return s*Lt;case"minutes":case"minute":case"mins":case"min":case"m":return s*Bt;case"seconds":case"second":case"secs":case"sec":case"s":return s*It;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(t);if("number"===s&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=Ft)return Ut(t,e,Ft,"day");if(e>=Lt)return Ut(t,e,Lt,"hour");if(e>=Bt)return Ut(t,e,Bt,"minute");if(e>=It)return Ut(t,e,It,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=Ft)return Math.round(t/Ft)+"d";if(e>=Lt)return Math.round(t/Lt)+"h";if(e>=Bt)return Math.round(t/Bt)+"m";if(e>=It)return Math.round(t/It)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function Ut(t,e,s,n){var o=e>=1.5*s;return Math.round(t/s)+" "+n+(o?"s":"")}var Vt=function(t){function e(t){let n,o=null;function i(...t){if(!i.enabled)return;const s=i,o=Number(new Date),r=o-(n||o);s.diff=r,s.prev=n,s.curr=o,n=o,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let a=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,((n,o)=>{if("%%"===n)return"%";a++;const i=e.formatters[o];if("function"==typeof i){const e=t[a];n=i.call(s,e),t.splice(a,1),a--}return n})),e.formatArgs.call(s,t);(s.log||e.log).apply(s,t)}return i.namespace=t,i.useColors=e.useColors(),i.color=e.selectColor(t),i.extend=s,i.destroy=e.destroy,Object.defineProperty(i,"enabled",{enumerable:!0,configurable:!1,get:()=>null===o?e.enabled(t):o,set:t=>{o=t}}),"function"==typeof e.init&&e.init(i),i}function s(t,s){const n=e(this.namespace+(void 0===s?":":s)+t);return n.log=this.log,n}function n(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},e.disable=function(){const t=[...e.names.map(n),...e.skips.map(n).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){let s;e.save(t),e.names=[],e.skips=[];const n=("string"==typeof t?t:"").split(/[\s,]+/),o=n.length;for(s=0;s<o;s++)n[s]&&("-"===(t=n[s].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let s,n;for(s=0,n=e.skips.length;s<n;s++)if(e.skips[s].test(t))return!1;for(s=0,n=e.names.length;s<n;s++)if(e.names[s].test(t))return!0;return!1},e.humanize=Wt,e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((s=>{e[s]=t[s]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let s=0;for(let e=0;e<t.length;e++)s=(s<<5)-s+t.charCodeAt(e),s|=0;return e.colors[Math.abs(s)%e.colors.length]},e.enable(e.load()),e};!function(t,e){e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const s="color: "+this.color;e.splice(1,0,s,"color: inherit");let n=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(n++,"%c"===t&&(o=n))})),e.splice(o,0,s)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(s){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(s){}!t&&"undefined"!=typeof process&&"env"in process&&(t={}.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=Vt(e);const{formatters:s}=t.exports;s.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(Pt,Pt.exports),Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.url=void 0;const Gt=At,Ht=Pt.exports("socket.io-client:url");Rt.url=function(t,e="",s){let n=t;s=s||"undefined"!=typeof location&&location,null==t&&(t=s.protocol+"//"+s.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?s.protocol+t:s.host+t),/^(https?|wss?):\/\//.test(t)||(Ht("protocol-less url %s",t),t=void 0!==s?s.protocol+"//"+t:"https://"+t),Ht("parse %s",t),n=Gt(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+e,n.href=n.protocol+"://"+o+(s&&s.port===n.port?"":":"+n.port),n};var Kt={},Yt={exports:{}},zt={},Jt={exports:{}};try{Jt.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(kn){Jt.exports=!1}var Xt="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();const Qt=Jt.exports,Zt=Xt;var te=function(t){const e=t.xdomain,s=t.xscheme,n=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||Qt))return new XMLHttpRequest}catch(o){}try{if("undefined"!=typeof XDomainRequest&&!s&&n)return new XDomainRequest}catch(o){}if(!e)try{return new(Zt[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(o){}},ee={exports:{}};const se=Object.create(null);se.open="0",se.close="1",se.ping="2",se.pong="3",se.message="4",se.upgrade="5",se.noop="6";const ne=Object.create(null);Object.keys(se).forEach((t=>{ne[se[t]]=t}));var oe={PACKET_TYPES:se,PACKET_TYPES_REVERSE:ne,ERROR_PACKET:{type:"error",data:"parser error"}};const{PACKET_TYPES:ie}=oe,re="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),ae="function"==typeof ArrayBuffer,ce=(t,e)=>{const s=new FileReader;return s.onload=function(){const t=s.result.split(",")[1];e("b"+t)},s.readAsDataURL(t)};var he,de=({type:t,data:e},s,n)=>{return re&&e instanceof Blob?s?n(e):ce(e,n):ae&&(e instanceof ArrayBuffer||(o=e,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(o):o&&o.buffer instanceof ArrayBuffer))?s?n(e instanceof ArrayBuffer?e:e.buffer):ce(new Blob([e]),n):n(ie[t]+(e||""));var o},le={};he="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",le.encode=function(t){var e,s=new Uint8Array(t),n=s.length,o="";for(e=0;e<n;e+=3)o+=he[s[e]>>2],o+=he[(3&s[e])<<4|s[e+1]>>4],o+=he[(15&s[e+1])<<2|s[e+2]>>6],o+=he[63&s[e+2]];return n%3==2?o=o.substring(0,o.length-1)+"=":n%3==1&&(o=o.substring(0,o.length-2)+"=="),o},le.decode=function(t){var e,s,n,o,i,r=.75*t.length,a=t.length,c=0;"="===t[t.length-1]&&(r--,"="===t[t.length-2]&&r--);var h=new ArrayBuffer(r),d=new Uint8Array(h);for(e=0;e<a;e+=4)s=he.indexOf(t[e]),n=he.indexOf(t[e+1]),o=he.indexOf(t[e+2]),i=he.indexOf(t[e+3]),d[c++]=s<<2|n>>4,d[c++]=(15&n)<<4|o>>2,d[c++]=(3&o)<<6|63&i;return h};const{PACKET_TYPES_REVERSE:ue,ERROR_PACKET:pe}=oe;let fe;"function"==typeof ArrayBuffer&&(fe=le);const ge=(t,e)=>{if(fe){const s=fe.decode(t);return me(s,e)}return{base64:!0,data:t}},me=(t,e)=>{switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}};const be=de,ye=(t,e)=>{if("string"!=typeof t)return{type:"message",data:me(t,e)};const s=t.charAt(0);if("b"===s)return{type:"message",data:ge(t.substring(1),e)};return ue[s]?t.length>1?{type:ue[s],data:t.substring(1)}:{type:ue[s]}:pe},we=String.fromCharCode(30);var _e={protocol:4,encodePacket:be,encodePayload:(t,e)=>{const s=t.length,n=new Array(s);let o=0;t.forEach(((t,i)=>{be(t,!1,(t=>{n[i]=t,++o===s&&e(n.join(we))}))}))},decodePacket:ye,decodePayload:(t,e)=>{const s=t.split(we),n=[];for(let o=0;o<s.length;o++){const t=ye(s[o],e);if(n.push(t),"error"===t.type)break}return n}},ve={exports:{}};!function(t){function e(t){if(t)return function(t){for(var s in e.prototype)t[s]=e.prototype[s];return t}(t)}ve.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},e.prototype.once=function(t,e){function s(){this.off(t,s),e.apply(this,arguments)}return s.fn=e,this.on(t,s),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var o=0;o<n.length;o++)if((s=n[o])===e||s.fn===e){n.splice(o,1);break}return 0===n.length&&delete this._callbacks["$"+t],this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),s=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(s){n=0;for(var o=(s=s.slice(0)).length;n<o;++n)s[n].apply(this,e)}return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}}();const ke=_e,xe=ve.exports,Ce=Pt.exports("engine.io-client:transport");var Ee,Se=class extends xe{constructor(t){super(),this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,e){const s=new Error(t);return s.type="TransportError",s.description=e,this.emit("error",s),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState?this.write(t):Ce("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,this.emit("open")}onData(t){const e=ke.decodePacket(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){this.emit("packet",t)}onClose(){this.readyState="closed",this.emit("close")}},$e={encode:function(t){var e="";for(var s in t)t.hasOwnProperty(s)&&(e.length&&(e+="&"),e+=encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e},decode:function(t){for(var e={},s=t.split("&"),n=0,o=s.length;n<o;n++){var i=s[n].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}},Oe="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Te={},je=0,Re=0;function Ne(t){var e="";do{e=Oe[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function De(){var t=Ne(+new Date);return t!==Ee?(je=0,Ee=t):t+"."+Ne(je++)}for(;Re<64;Re++)Te[Oe[Re]]=Re;De.encode=Ne,De.decode=function(t){var e=0;for(Re=0;Re<t.length;Re++)e=64*e+Te[t.charAt(Re)];return e};var Ae=De;const Pe=Se,Ie=$e,Be=_e,Le=Ae,Fe=Pt.exports("engine.io-client:polling");var Me=class extends Pe{get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{Fe("paused"),this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(Fe("we are currently polling - waiting to pause"),t++,this.once("pollComplete",(function(){Fe("pre-pause polling complete"),--t||e()}))),this.writable||(Fe("we are currently writing - waiting to pause"),t++,this.once("drain",(function(){Fe("pre-pause writing complete"),--t||e()})))}else e()}poll(){Fe("polling"),this.polling=!0,this.doPoll(),this.emit("poll")}onData(t){Fe("polling got data %s",t);Be.decodePayload(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose(),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():Fe('ignoring poll - transport state "%s"',this.readyState))}doClose(){const t=()=>{Fe("writing close packet"),this.write([{type:"close"}])};"open"===this.readyState?(Fe("transport open - closing"),t()):(Fe("transport not open - deferring close"),this.once("open",t))}write(t){this.writable=!1,Be.encodePayload(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emit("drain")}))}))}uri(){let t=this.query||{};const e=this.opts.secure?"https":"http";let s="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=Le()),this.supportsBinary||t.sid||(t.b64=1),t=Ie.encode(t),this.opts.port&&("https"===e&&443!==Number(this.opts.port)||"http"===e&&80!==Number(this.opts.port))&&(s=":"+this.opts.port),t.length&&(t="?"+t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+t}},qe={pick:(t,...e)=>e.reduce(((e,s)=>(t.hasOwnProperty(s)&&(e[s]=t[s]),e)),{})};const We=te,Ue=Me,Ve=ve.exports,{pick:Ge}=qe,He=Xt,Ke=Pt.exports("engine.io-client:polling-xhr");function Ye(){}const ze=null!=new We({xdomain:!1}).responseType;class Je extends Ve{constructor(t,e){super(),this.opts=e,this.method=e.method||"GET",this.uri=t,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.create()}create(){const t=Ge(this.opts,"agent","enablesXDR","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const e=this.xhr=new We(t);try{Ke("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&e.setRequestHeader(t,this.opts.extraHeaders[t])}}catch(s){}if("POST"===this.method)try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{e.setRequestHeader("Accept","*/*")}catch(s){}"withCredentials"in e&&(e.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(e.timeout=this.opts.requestTimeout),this.hasXDR()?(e.onload=()=>{this.onLoad()},e.onerror=()=>{this.onError(e.responseText)}):e.onreadystatechange=()=>{4===e.readyState&&(200===e.status||1223===e.status?this.onLoad():setTimeout((()=>{this.onError("number"==typeof e.status?e.status:0)}),0))},Ke("xhr data %s",this.data),e.send(this.data)}catch(s){return void setTimeout((()=>{this.onError(s)}),0)}"undefined"!=typeof document&&(this.index=Je.requestsCount++,Je.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(t){this.emit("data",t),this.onSuccess()}onError(t){this.emit("error",t),this.cleanup(!0)}cleanup(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=Ye:this.xhr.onreadystatechange=Ye,t)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Je.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&this.onData(t)}hasXDR(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR}abort(){this.cleanup()}}if(Je.requestsCount=0,Je.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",Xe);else if("function"==typeof addEventListener){addEventListener("onpagehide"in He?"pagehide":"unload",Xe,!1)}function Xe(){for(let t in Je.requests)Je.requests.hasOwnProperty(t)&&Je.requests[t].abort()}ee.exports=class extends Ue{constructor(t){if(super(t),"undefined"!=typeof location){const e="https:"===location.protocol;let s=location.port;s||(s=e?443:80),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||s!==t.port,this.xs=t.secure!==e}const e=t&&t.forceBase64;this.supportsBinary=ze&&!e}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Je(this.uri(),t)}doWrite(t,e){const s=this.request({method:"POST",data:t});s.on("success",e),s.on("error",(t=>{this.onError("xhr post error",t)}))}doPoll(){Ke("xhr poll");const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(t=>{this.onError("xhr poll error",t)})),this.pollXhr=t}},ee.exports.Request=Je;const Qe=Me,Ze=Xt,ts=/\n/g,es=/\\n/g;let ss;var ns=class extends Qe{constructor(t){super(t),this.query=this.query||{},ss||(ss=Ze.___eio=Ze.___eio||[]),this.index=ss.length,ss.push(this.onData.bind(this)),this.query.j=this.index}get supportsBinary(){return!1}doClose(){this.script&&(this.script.onerror=()=>{},this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),super.doClose()}doPoll(){const t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=t=>{this.onError("jsonp poll error",t)};const e=document.getElementsByTagName("script")[0];e?e.parentNode.insertBefore(t,e):(document.head||document.body).appendChild(t),this.script=t;"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){const t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)}),100)}doWrite(t,e){let s;if(!this.form){const t=document.createElement("form"),e=document.createElement("textarea"),s=this.iframeId="eio_iframe_"+this.index;t.className="socketio",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.target=s,t.method="POST",t.setAttribute("accept-charset","utf-8"),e.name="d",t.appendChild(e),document.body.appendChild(t),this.form=t,this.area=e}function n(){o(),e()}this.form.action=this.uri();const o=()=>{if(this.iframe)try{this.form.removeChild(this.iframe)}catch(t){this.onError("jsonp polling iframe removal error",t)}try{const t='<iframe src="javascript:0" name="'+this.iframeId+'">';s=document.createElement(t)}catch(t){s=document.createElement("iframe"),s.name=this.iframeId,s.src="javascript:0"}s.id=this.iframeId,this.form.appendChild(s),this.iframe=s};o(),t=t.replace(es,"\\\n"),this.area.value=t.replace(ts,"\\n");try{this.form.submit()}catch(i){}this.iframe.attachEvent?this.iframe.onreadystatechange=()=>{"complete"===this.iframe.readyState&&n()}:this.iframe.onload=n}};const os=Xt;var is={WebSocket:os.WebSocket||os.MozWebSocket,usingBrowserWebSocket:!0,defaultBinaryType:"arraybuffer"};const rs=Se,as=_e,cs=$e,hs=Ae,{pick:ds}=qe,{WebSocket:ls,usingBrowserWebSocket:us,defaultBinaryType:ps}=is,fs=Pt.exports("engine.io-client:websocket"),gs="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class ms extends rs{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,s=gs?{}:ds(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=us&&!gs?e?new ls(t,e):new ls(t):new ls(t,e,s)}catch(kn){return this.emit("error",kn)}this.ws.binaryType=this.socket.binaryType||ps,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const s=t[e],n=e===t.length-1;as.encodePacket(s,this.supportsBinary,(t=>{const e={};if(!us&&(s.options&&(e.compress=s.options.compress),this.opts.perMessageDeflate)){("string"==typeof t?Buffer.byteLength(t):t.length)<this.opts.perMessageDeflate.threshold&&(e.compress=!1)}try{us?this.ws.send(t):this.ws.send(t,e)}catch(o){fs("websocket closed before onclose event")}n&&setTimeout((()=>{this.writable=!0,this.emit("drain")}),0)}))}}onClose(){rs.prototype.onClose.call(this)}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const e=this.opts.secure?"wss":"ws";let s="";this.opts.port&&("wss"===e&&443!==Number(this.opts.port)||"ws"===e&&80!==Number(this.opts.port))&&(s=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=hs()),this.supportsBinary||(t.b64=1),t=cs.encode(t),t.length&&(t="?"+t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+t}check(){return!(!ls||"__initialize"in ls&&this.name===ms.prototype.name)}}var bs=ms;const ys=te,ws=ee.exports,_s=ns,vs=bs;zt.polling=function(t){let e,s=!1,n=!1;const o=!1!==t.jsonp;if("undefined"!=typeof location){const e="https:"===location.protocol;let o=location.port;o||(o=e?443:80),s=t.hostname!==location.hostname||o!==t.port,n=t.secure!==e}if(t.xdomain=s,t.xscheme=n,e=new ys(t),"open"in e&&!t.forceJSONP)return new ws(t);if(!o)throw new Error("JSONP disabled");return new _s(t)},zt.websocket=vs;const ks=zt,xs=ve.exports,Cs=Pt.exports("engine.io-client:socket"),Es=_e,Ss=At,$s=$e;class Os extends xs{constructor(t,e={}){super(),t&&"object"==typeof t&&(e=t,t=null),t?(t=Ss(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=Ss(e.host).host),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.transports=e.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,jsonp:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},e),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=$s.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",(()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())}),!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){Cs('creating transport "%s"',t);const e=function(t){const e={};for(let s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);return e}(this.opts.query);e.EIO=Es.protocol,e.transport=t,this.id&&(e.sid=this.id);const s=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return Cs("options: %j",s),new ks[t](s)}open(){let t;if(this.opts.rememberUpgrade&&Os.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void setTimeout((()=>{this.emit("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(e){return Cs("error while creating transport: %s",e),this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){Cs("setting transport %s",t.name),this.transport&&(Cs("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(()=>{this.onClose("transport close")}))}probe(t){Cs('probing transport "%s"',t);let e=this.createTransport(t,{probe:1}),s=!1;Os.priorWebsocketSuccess=!1;const n=()=>{s||(Cs('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",(n=>{if(!s)if("pong"===n.type&&"probe"===n.data){if(Cs('probe transport "%s" pong',t),this.upgrading=!0,this.emit("upgrading",e),!e)return;Os.priorWebsocketSuccess="websocket"===e.name,Cs('pausing current transport "%s"',this.transport.name),this.transport.pause((()=>{s||"closed"!==this.readyState&&(Cs("changing transport and sending upgrade packet"),h(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emit("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{Cs('probe transport "%s" failed',t);const s=new Error("probe error");s.transport=e.name,this.emit("upgradeError",s)}})))};function o(){s||(s=!0,h(),e.close(),e=null)}const i=s=>{const n=new Error("probe error: "+s);n.transport=e.name,o(),Cs('probe transport "%s" failed because of error: %s',t,s),this.emit("upgradeError",n)};function r(){i("transport closed")}function a(){i("socket closed")}function c(t){e&&t.name!==e.name&&(Cs('"%s" works - aborting "%s"',t.name,e.name),o())}const h=()=>{e.removeListener("open",n),e.removeListener("error",i),e.removeListener("close",r),this.removeListener("close",a),this.removeListener("upgrading",c)};e.once("open",n),e.once("error",i),e.once("close",r),this.once("close",a),this.once("upgrading",c),e.open()}onOpen(){if(Cs("socket open"),this.readyState="open",Os.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){Cs("starting upgrade probes");let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(Cs('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emit("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else Cs('packet received with socket readyState "%s"',this.readyState)}onHandshake(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=setTimeout((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()}flush(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Cs("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))}write(t,e,s){return this.sendPacket("message",t,e,s),this}send(t,e,s){return this.sendPacket("message",t,e,s),this}sendPacket(t,e,s,n){if("function"==typeof e&&(n=e,e=void 0),"function"==typeof s&&(n=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const o={type:t,data:e,options:s};this.emit("packetCreate",o),this.writeBuffer.push(o),n&&this.once("flush",n),this.flush()}close(){const t=()=>{this.onClose("forced close"),Cs("socket closing - telling transport to close"),this.transport.close()},e=()=>{this.removeListener("upgrade",e),this.removeListener("upgradeError",e),t()},s=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?s():t()})):this.upgrading?s():t()),this}onError(t){Cs("socket error %j",t),Os.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)}onClose(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(Cs('socket close with reason: "%s"',t),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const e=[];let s=0;const n=t.length;for(;s<n;s++)~this.transports.indexOf(t[s])&&e.push(t[s]);return e}}Os.priorWebsocketSuccess=!1,Os.protocol=Es.protocol;const Ts=Os;Yt.exports=(t,e)=>new Ts(t,e),Yt.exports.Socket=Ts,Yt.exports.protocol=Ts.protocol,Yt.exports.Transport=Se,Yt.exports.transports=zt,Yt.exports.parser=_e;var js={},Rs={},Ns={},Ds={};Object.defineProperty(Ds,"__esModule",{value:!0}),Ds.hasBinary=Ds.isBinary=void 0;const As="function"==typeof ArrayBuffer,Ps=Object.prototype.toString,Is="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Ps.call(Blob),Bs="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Ps.call(File);function Ls(t){return As&&(t instanceof ArrayBuffer||(t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer)(t))||Is&&t instanceof Blob||Bs&&t instanceof File}Ds.isBinary=Ls,Ds.hasBinary=function t(e,s){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let s=0,n=e.length;s<n;s++)if(t(e[s]))return!0;return!1}if(Ls(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return t(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return!0;return!1},Object.defineProperty(Ns,"__esModule",{value:!0}),Ns.reconstructPacket=Ns.deconstructPacket=void 0;const Fs=Ds;function Ms(t,e){if(!t)return t;if(Fs.isBinary(t)){const s={_placeholder:!0,num:e.length};return e.push(t),s}if(Array.isArray(t)){const s=new Array(t.length);for(let n=0;n<t.length;n++)s[n]=Ms(t[n],e);return s}if("object"==typeof t&&!(t instanceof Date)){const s={};for(const n in t)t.hasOwnProperty(n)&&(s[n]=Ms(t[n],e));return s}return t}function qs(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(Array.isArray(t))for(let s=0;s<t.length;s++)t[s]=qs(t[s],e);else if("object"==typeof t)for(const s in t)t.hasOwnProperty(s)&&(t[s]=qs(t[s],e));return t}Ns.deconstructPacket=function(t){const e=[],s=t.data,n=t;return n.data=Ms(s,e),n.attachments=e.length,{packet:n,buffers:e}},Ns.reconstructPacket=function(t,e){return t.data=qs(t.data,e),t.attachments=void 0,t},function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Decoder=t.Encoder=t.PacketType=t.protocol=void 0;const e=ve.exports,s=Ns,n=Ds,o=Pt.exports("socket.io-parser");var i,r;t.protocol=5,(r=i=t.PacketType||(t.PacketType={}))[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK";t.Encoder=class{encode(t){return o("encoding packet %j",t),t.type!==i.EVENT&&t.type!==i.ACK||!n.hasBinary(t)?[this.encodeAsString(t)]:(t.type=t.type===i.EVENT?i.BINARY_EVENT:i.BINARY_ACK,this.encodeAsBinary(t))}encodeAsString(t){let e=""+t.type;return t.type!==i.BINARY_EVENT&&t.type!==i.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data)),o("encoded %j as %s",t,e),e}encodeAsBinary(t){const e=s.deconstructPacket(t),n=this.encodeAsString(e.packet),o=e.buffers;return o.unshift(n),o}};class a extends e{constructor(){super()}add(t){let e;if("string"==typeof t)e=this.decodeString(t),e.type===i.BINARY_EVENT||e.type===i.BINARY_ACK?(this.reconstructor=new c(e),0===e.attachments&&super.emit("decoded",e)):super.emit("decoded",e);else{if(!n.isBinary(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emit("decoded",e))}}decodeString(t){let e=0;const s={type:Number(t.charAt(0))};if(void 0===i[s.type])throw new Error("unknown packet type "+s.type);if(s.type===i.BINARY_EVENT||s.type===i.BINARY_ACK){const n=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const o=t.substring(n,e);if(o!=Number(o)||"-"!==t.charAt(e))throw new Error("Illegal attachments");s.attachments=Number(o)}if("/"===t.charAt(e+1)){const n=e+1;for(;++e;){if(","===t.charAt(e))break;if(e===t.length)break}s.nsp=t.substring(n,e)}else s.nsp="/";const n=t.charAt(e+1);if(""!==n&&Number(n)==n){const n=e+1;for(;++e;){const s=t.charAt(e);if(null==s||Number(s)!=s){--e;break}if(e===t.length)break}s.id=Number(t.substring(n,e+1))}if(t.charAt(++e)){const n=function(t){try{return JSON.parse(t)}catch(e){return!1}}(t.substr(e));if(!a.isPayloadValid(s.type,n))throw new Error("invalid payload");s.data=n}return o("decoded %s as %j",t,s),s}static isPayloadValid(t,e){switch(t){case i.CONNECT:return"object"==typeof e;case i.DISCONNECT:return void 0===e;case i.CONNECT_ERROR:return"string"==typeof e||"object"==typeof e;case i.EVENT:case i.BINARY_EVENT:return Array.isArray(e)&&e.length>0;case i.ACK:case i.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}t.Decoder=a;class c{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=s.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}}(Rs);var Ws={};Object.defineProperty(Ws,"__esModule",{value:!0}),Ws.on=void 0,Ws.on=function(t,e,s){return t.on(e,s),function(){t.off(e,s)}};var Us={};Object.defineProperty(Us,"__esModule",{value:!0}),Us.StrictEventEmitter=void 0;const Vs=ve.exports;Us.StrictEventEmitter=class extends Vs{on(t,e){return super.on(t,e),this}once(t,e){return super.once(t,e),this}emit(t,...e){return super.emit(t,...e),this}emitReserved(t,...e){return super.emit(t,...e),this}listeners(t){return super.listeners(t)}},Object.defineProperty(js,"__esModule",{value:!0}),js.Socket=void 0;const Gs=Rs,Hs=Ws,Ks=Us,Ys=Pt.exports("socket.io-client:socket"),zs=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Js extends Ks.StrictEventEmitter{constructor(t,e,s){super(),this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},s&&s.auth&&(this.auth=s.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Hs.on(t,"open",this.onopen.bind(this)),Hs.on(t,"packet",this.onpacket.bind(this)),Hs.on(t,"error",this.onerror.bind(this)),Hs.on(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(zs.hasOwnProperty(t))throw new Error('"'+t+'" is a reserved event name');e.unshift(t);const s={type:Gs.PacketType.EVENT,data:e,options:{}};s.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(Ys("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),s.id=this.ids++);const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)?Ys("discard packet as the transport is not currently writable"):this.connected?this.packet(s):this.sendBuffer.push(s),this.flags={},this}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){Ys("transport is open - connecting"),"function"==typeof this.auth?this.auth((t=>{this.packet({type:Gs.PacketType.CONNECT,data:t})})):this.packet({type:Gs.PacketType.CONNECT,data:this.auth})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t){Ys("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",t)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Gs.PacketType.CONNECT:if(t.data&&t.data.sid){const e=t.data.sid;this.onconnect(e)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Gs.PacketType.EVENT:case Gs.PacketType.BINARY_EVENT:this.onevent(t);break;case Gs.PacketType.ACK:case Gs.PacketType.BINARY_ACK:this.onack(t);break;case Gs.PacketType.DISCONNECT:this.ondisconnect();break;case Gs.PacketType.CONNECT_ERROR:const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){const e=t.data||[];Ys("emitting event %j",e),null!=t.id&&(Ys("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const s of e)s.apply(this,t)}super.emit.apply(this,t)}ack(t){const e=this;let s=!1;return function(...n){s||(s=!0,Ys("sending ack %j",n),e.packet({type:Gs.PacketType.ACK,id:t,data:n}))}}onack(t){const e=this.acks[t.id];"function"==typeof e?(Ys("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):Ys("bad ack %s",t.id)}onconnect(t){Ys("socket connected with id %s",t),this.id=t,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>this.packet(t))),this.sendBuffer=[]}ondisconnect(){Ys("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(Ys("performing disconnect (%s)",this.nsp),this.packet({type:Gs.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}js.Socket=Js;var Xs=Qs;function Qs(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Qs.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),s=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-s:t+s}return 0|Math.min(t,this.max)},Qs.prototype.reset=function(){this.attempts=0},Qs.prototype.setMin=function(t){this.ms=t},Qs.prototype.setMax=function(t){this.max=t},Qs.prototype.setJitter=function(t){this.jitter=t},Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.Manager=void 0;const Zs=Yt.exports,tn=js,en=Rs,sn=Ws,nn=Xs,on=Us,rn=Pt.exports("socket.io-client:manager");class an extends on.StrictEventEmitter{constructor(t,e){super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new nn({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=t;const s=e.parser||en;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(rn("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;rn("opening %s",this.uri),this.engine=Zs(this.uri,this.opts);const e=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const n=sn.on(e,"open",(function(){s.onopen(),t&&t()})),o=sn.on(e,"error",(e=>{rn("error"),s.cleanup(),s._readyState="closed",this.emitReserved("error",e),t?t(e):s.maybeReconnectOnOpen()}));if(!1!==this._timeout){const t=this._timeout;rn("connect attempt will timeout after %d",t),0===t&&n();const s=setTimeout((()=>{rn("connect attempt timed out after %d",t),n(),e.close(),e.emit("error",new Error("timeout"))}),t);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}return this.subs.push(n),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){rn("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(sn.on(t,"ping",this.onping.bind(this)),sn.on(t,"data",this.ondata.bind(this)),sn.on(t,"error",this.onerror.bind(this)),sn.on(t,"close",this.onclose.bind(this)),sn.on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){this.decoder.add(t)}ondecoded(t){this.emitReserved("packet",t)}onerror(t){rn("error",t),this.emitReserved("error",t)}socket(t,e){let s=this.nsps[t];return s||(s=new tn.Socket(this,t,e),this.nsps[t]=s),s}_destroy(t){const e=Object.keys(this.nsps);for(const s of e){if(this.nsps[s].active)return void rn("socket %s is still active, skipping close",s)}this._close()}_packet(t){rn("writing packet %j",t);const e=this.encoder.encode(t);for(let s=0;s<e.length;s++)this.engine.write(e[s],t.options)}cleanup(){rn("cleanup"),this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){rn("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,"opening"===this._readyState&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t){rn("onclose"),this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)rn("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();rn("will wait %dms before reconnect attempt",e),this._reconnecting=!0;const s=setTimeout((()=>{t.skipReconnect||(rn("attempting reconnect"),this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(rn("reconnect attempt error"),t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):(rn("reconnect success"),t.onreconnect())})))}),e);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}Kt.Manager=an,function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.io=e.Socket=e.Manager=e.protocol=void 0;const s=Rt,n=Kt,o=Pt.exports("socket.io-client");t.exports=e=r;const i=e.managers={};function r(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};const r=s.url(t,e.path||"/socket.io"),a=r.source,c=r.id,h=r.path,d=i[c]&&h in i[c].nsps;let l;return e.forceNew||e["force new connection"]||!1===e.multiplex||d?(o("ignoring socket cache for %s",a),l=new n.Manager(a,e)):(i[c]||(o("new io instance for %s",a),i[c]=new n.Manager(a,e)),l=i[c]),r.query&&!e.query&&(e.query=r.queryKey),l.socket(r.path,e)}e.io=r;var a=Rs;Object.defineProperty(e,"protocol",{enumerable:!0,get:function(){return a.protocol}}),e.connect=r;var c=Kt;Object.defineProperty(e,"Manager",{enumerable:!0,get:function(){return c.Manager}});var h=js;Object.defineProperty(e,"Socket",{enumerable:!0,get:function(){return h.Socket}}),e.default=r}(jt,jt.exports);var cn=Tt(jt.exports);cn.Manager,cn.Socket;class hn{constructor(t){return this.recvMsg=t,this.sock=null,this.checker=null,this.first_connect=!0,this.data=h.observable({last_msg:{topic:null,payload:null},status:"off",status_txt:"off"}),this}start(t){this.data.status="bad";const e=t.tls?"https":"http",s={path:t.path},n=e+"://"+t.hostname+"/";console.log("Socket IO server address:",n),console.log("Socket IO options:",JSON.stringify(s)),this.sock=cn(n,s),this.sock.on("connect_error",(t=>{console.log("SIO connect error:",t),this.data.status="err",this.data.status_txt=t})),this.sock.on("disconnect",(t=>{console.log("SIO disconnect:",t),"io server disconnect"===t&&(this.data.status="off",this.data.status_txt="off",this.sock=null)})),this.sock.on("connect",(()=>{console.log("SIO connected"),this.setStatus(),this.sock.emit("msg","$ctrl",t.config&&this.first_connect?"start":"continue"),this.first_connect=!1})),this.sock.on("msg",((t,e)=>{console.log("SIO rx:",t,e),"string"==typeof t&&void 0!==e?(this.recvMsg(t,e),this.setStatus()):console.log("SIO rx: message is missing topic and/or payload",t,e)}))}setStatus(){null===this.sock?(this.data.status="off",this.data.status_txt="off"):this.sock.connected&&0==this.sock.sendBuffer.length?(this.data.status="ok",this.data.status_txt="OK"):(this.data.status="bad",this.data.status_txt=`${this.sock.connected?"":"dis"}connected, ${this.sock.sendBuffer.length} queued`)}stop(){this.sock&&(console.log("SIO: closing"),this.sock.close()),this.sock=null,this.setStatus()}serverSend(t,e){this.sock&&(this.sock.emit("msg",t,e),this.sock.sendBuffer.length>0&&null===this.checker&&(this.checker=window.setInterval((()=>{this.setStatus(),0===this.sock.sendBuffer.length&&(window.clearInterval(this.checker),this.checker=null)}),1e3)))}}const dn={};var ln=H({name:"Connections",components:{Masonry:z,MasonryBrick:Q,DemoSettings:et,WebsockSettings:ft,SockioSettings:Ot},data:()=>({show_dialog:!1,connections:{demo:{connClass:lt,settClass:et},websocket:{connClass:Et,settClass:ft},sockio:{connClass:hn,settClass:Ot}},config_source:null}),computed:{icon_color(){let t=0,e=0;for(const s in this.connections)if("conn"in this.connections[s])switch(this.connections[s].conn.data.status){case"ok":t++;break;case"bad":e++}return t?e?"warning":"success":e?"error":"grey"},gotConfig(){return void 0!==this.$config.dash.title},config_wait(){return!this.gotConfig&&this.config_source&&this.connections[this.config_source].conn&&"ok"==this.connections[this.config_source].conn.data.status},demo_config(){return this.$config.conn?this.$config.conn.demo:void 0},websock_config(){return this.$config.conn?this.$config.conn.websocket:void 0},sockio_config(){return this.$config.conn?this.$config.conn.sockio:void 0},config_source_name(){return this.config_source||"none"}},inject:["$store","$config"],created(){console.log("Connection: created");const t=this.$config.conn;for(name in this.$set(t,"demo",{enabled:!1,config:!1}),this.$set(t,"websocket",{enabled:!1,config:!1,address:""}),this.$set(t,"sockio",{enabled:!1,config:!1,hostname:"",path:"",tls:!1}),this.connections){const t=this.connections[name];t.conn=new t.connClass(this.handleMsg)}const e=this.$root.params;e&&e.get("sio")?(t.sockio.address=e.get("sio"),t.sockio.enabled=!0,t.sockio.config=!0,this.config_source="sockio",this.$emit("src","sockio "+t.sockio.address)):e&&e.get("ws")?(t.websocket.address=e.get("ws"),t.websocket.enabled=!0,t.websocket.config=!0,this.config_source="websocket",this.$emit("src","websocket "+t.websocket.address)):(t.demo.enabled=!0,t.demo.config=!0,this.config_source="demo",this.$emit("src","demo")),console.log("Initial connection config:",JSON.stringify(t)),this.$root.serverSend=(t,e)=>this.serverSend(t,e),this.$store.serverSend=(t,e)=>this.serverSend(t,e)},mounted(){window.setTimeout((()=>{this.gotConfig||(this.show_dialog=!0)}),5e3)},beforeDestroy(){for(name in console.log("Connection: beforeDestroy"),this.connections){const t=this.connections[name];t.conn&&t.conn.stop()}},methods:{showDialog(t){this.show_dialog=!0,t.stopPropagation()},sendConfig(){for(let t in this.$config)this.serverSend("$config/"+t,this.$config[t])},handleMsg(t,e){if("$config"===t){const t=e;if(console.log("*** config received with keys:",Object.keys(t)),this.$config.dash.title)return void console.log("Already got config, dropping message");if(!e||!e.dash){console.log("*** No or broken config, clearing! (got:",e),this.$store.initDash();const t=this.$config.dash.tabs[0],s=this.$config.tabs[t].grids[0],n=this.$store.addWidget(s,"Markdown"),o=this.$config.grids[s].widgets[n];return this.$store.updateWidget(o,{cols:3,rows:3}),this.$store.updateWidgetProp(o,"static","title",""),this.$store.updateWidgetProp(o,"static","text","# Welcome to FlexDash\nThis is an empty dashboard. You can add some demo/informational tabs by opening the\nconnections panel using the network icon in the upper right and using the\ninject buttons in the demo section."),void this.sendConfig()}}this.$store.insertData(t,e)},serverSend(t,e){if(t.startsWith("$demo"))this.$store.insertData(t,e);else if(t.startsWith("$config")&&this.config_source)this.connections[this.config_source].conn.serverSend(t,e);else for(let s in this.connections){const n=this.connections[s].conn;console.log(s,n,this.$config.conn[s]),n&&this.$config.conn[s].enabled&&n.serverSend(t,e)}},changeConfig(t,e){this.$config.conn[t]=e}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mx-2"},[s(g,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;return[s(l,t._g({attrs:{small:"",icon:"",color:t.icon_color}},Object.assign({},{click:t.showDialog},n)),[s(m,[t._v("mdi-network")])],1)]}}])},[s("span",[t._v("Server connections")])]),s(b,{attrs:{eager:""},model:{value:t.show_dialog,callback:function(e){t.show_dialog=e},expression:"show_dialog"}},[s(y,[s(w,{staticClass:"d-flex"},[s("span",[t._v("Server Connections")]),s(_),s(l,{attrs:{elevation:"0",icon:""},on:{click:function(e){t.show_dialog=!1}}},[s(m,[t._v("mdi-close")])],1)],1),t.config_wait?s(v,[s(u,{staticClass:"mr-1",attrs:{small:"",color:"error"}},[t._v("error")]),t._v(" "+t._s(t.config_source)+" connected but server is not sending configuration ")],1):t._e(),s("masonry",{staticClass:"v-card__text"},[s("masonry-brick",[s("div",[s("h3",{staticClass:"mb-1"},[t._v("Saving the dashboard config")]),s("p",[t._v("The dashboard's configuration is generally saved to the connection from which it was initially loaded. If that is the demo then no saving occurs.")]),s("p"),s("div",[s("span",{staticClass:"font-weight-medium"},[t._v("Saving to:")]),s(u,{staticClass:"ml-3"},[t._v(t._s(t.config_source_name))])],1)])]),s("masonry-brick",[s("sockio-settings",{attrs:{connection:t.connections.sockio.conn,config:t.sockio_config},on:{change:function(e){return t.changeConfig("sockio",e)}}})],1),s("masonry-brick",[s("websock-settings",{attrs:{connection:t.connections.websocket.conn,config:t.websock_config},on:{change:function(e){return t.changeConfig("websock",e)}}})],1),s("masonry-brick",[s("demo-settings",{attrs:{connection:t.connections.demo.conn,config:t.demo_config},on:{change:function(e){return t.changeConfig("demo",e)}}})],1)],1)],1)],1)],1)}),[],!1,(function(t){for(let e in dn)this[e]=dn[e]}),null,null,null);ln.options.__file="src/components/connections.vue";var un=ln.exports;const pn={};var fn=H({name:"TabEdit",inject:["$config","$store"],model:{prop:"tab_edit",event:"change"},props:{tab_edit:!1,tab_ix:null,tab_id:null},computed:{tab(){return this.tab_id?this.$config.tabs[this.tab_id]:{}},tab_kind(){return"grids"in this.tab?"grid":"iframe"},grid_num(){return(this.tab.grids||[]).length}},data:()=>({}),methods:{deleteTab(){this.$store.deleteTab(this.tab_ix),this.$emit("change",!1)},handleEdit(t,e){console.log("handleEdit",t,e);const s={};s[t]=e,this.$store.updateTab(this.tab_id,s)},moveTab(t){const e=this.tab_ix,s=this.$config.dash.tabs;if(!(e+t>=0&&e+t<s.length))return;let n=[...s],o=n[e];n[e]=n[e+t],n[e+t]=o,this.$store.updateDash({tabs:n}),console.log(`Moving tab ${this.tab_ix} to ${e+t}`),this.$emit("reload",e+t)},addGrid(){this.$store.addGrid(this.tab_id)}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s(y,{staticClass:"pb-2",attrs:{color:"surface"}},[s(v,{staticClass:"d-flex px-2"},[s(g,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;return[s(l,t._g({attrs:{small:"",icon:""},on:{click:function(e){return t.moveTab(-1)}}},n),[s(m,[t._v("mdi-arrow-left-bold")])],1)]}}])},[s("span",[t._v("Move tab left")])]),s(g,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;return[s(l,t._g({attrs:{small:"",icon:""},on:{click:function(e){return t.moveTab(1)}}},n),[s(m,[t._v("mdi-arrow-right-bold")])],1)]}}])},[s("span",[t._v("Move tab right")])]),s(_),s(l,{staticClass:"mx-auto",attrs:{small:""},on:{click:t.deleteTab}},[t._v("Delete tab")]),s(_),s(l,{attrs:{small:"",elevation:"0",icon:""},on:{click:function(e){return t.$emit("change",!1)}}},[s(m,[t._v("mdi-close")])],1)],1),s(v,{staticClass:"d-flex flex-column"},[s(p,{staticClass:"flex-grow-0",attrs:{dense:"",label:"icon","persistent-hint":"",hint:"yes",value:t.tab.icon},on:{input:function(e){return t.handleEdit("icon",e)}},scopedSlots:t._u([{key:"message",fn:function(){return[s("span",[t._v("See "),s("a",{attrs:{target:"_blank",href:"https://materialdesignicons.com"}},[t._v(" materialdesignicons.com "),s(m,{attrs:{color:"primary","x-small":""}},[t._v("mdi-open-in-new")])],1)])]},proxy:!0}])}),s(p,{staticClass:"flex-grow-0 mt-6",attrs:{dense:"",label:"tab title",value:t.tab.title},on:{input:function(e){return t.handleEdit("title",e)}}}),s("div",{staticClass:"d-flex align-baseline justify-start mt-2"},[s("span",{staticClass:"text-body-1 font-weight-medium"},[t._v("Tab type:")]),s(u,{staticClass:"ml-2",attrs:{small:""}},[t._v(t._s(t.tab_kind))])],1),"grid"==t.tab_kind?s("div",{staticClass:"d-flex mx-2 align-baseline justify-start"},[s(v,{staticClass:"px-1 mr-3",staticStyle:{width:"auto"}},[t._v(" "+t._s(t.grid_num)+" grid"+t._s(t.grid_num>1?"s":"")+" ")]),s(l,{attrs:{small:""},on:{click:t.addGrid}},[t._v("Add grid")])],1):t._e(),"iframe"==t.tab_kind?s("div",{staticClass:"mx-2"},[s(k,{attrs:{row:"",mandatory:"","hide-details":"",value:t.tab.slot}},[s("template",{slot:"label"},[s("span",{staticClass:"mr-2"},[t._v("Slot:")])]),s(x,{attrs:{label:"A",value:"a"},on:{click:function(e){return t.handleEdit("slot","a")}}}),s(x,{attrs:{label:"B",value:"b"},on:{click:function(e){return t.handleEdit("slot","b")}}})],2),s(p,{staticClass:"mt-4",staticStyle:{width:"40ex"},attrs:{dense:"",label:"url",value:t.tab.url},on:{input:function(e){return t.handleEdit("url",e)}}})],1):t._e()],1)],1)}),[],!1,(function(t){for(let e in pn)this[e]=pn[e]}),"50a9d49a",null,null);fn.options.__file="src/components/tab-edit.vue";var gn=fn.exports;const mn={};var bn=H({name:"Dash",components:{Connections:un,TabEdit:gn},inject:["$config","$store","palette"],data:()=>({appTitle:"FlexDash",sidebar:!1,tab_ix:null,tab_edit:!1,tab_add:!1,iframe_a_src:null,iframe_b_src:null,settings_menu:null,settings:{edit:"Edit mode",theme:"Toggle theme"},config_src:""}),computed:{gotConfig(){return void 0!==this.$config.dash.title},dash(){return this.gotConfig?this.$config.dash:{}},dash_tabs(){return this.dash.tabs||[]},tab(){return this.tab_id?this.tabs[this.tab_id]:{}},tab_id(){return null!=this.tab_ix?this.dash_tabs[this.tab_ix]:""},tabs(){return this.gotConfig?this.$config.tabs:{}},grids(){return this.gotConfig?this.$config.grids:{}},theme(){return this.$vuetify.theme.dark?"dark":"light"},canUndo(){return this.$store.undo.buf.length>0},iframe_a_show(){return this.tab.url&&"a"==this.tab.slot},iframe_a_class(){return["iframe-tab-wrap",{"iframe-a--active":this.iframe_a_show}]},iframe_b_show(){return this.tab.url&&"b"==this.tab.slot},iframe_b_class(){return["iframe-tab-wrap",{"iframe-b--active":this.iframe_b_show}]},tab_show(){return!!this.tab.grids},tabs_items_class(){return{"tabs--active":this.tab_show}}},watch:{tabs(t){this.tab_ix>=t.length&&(this.tab_ix=t.length-1)},tab:{deep:!0,immediate:!0,handler(t){t.url&&("a"==t.slot&&(this.iframe_a_src=t.url),"b"==t.slot&&(this.iframe_b_src=t.url),console.log("iframe_a_src:",this.iframe_a_src))}}},mounted(){if(console.log(`FlexDash! route=${this.$root.route} params=${this.$root.params}`),this.$root.route.match(/^#[0-9]+$/)){const t=Number.parseInt(this.$root.route.substr(1),10);t>=0&&t<this.dash_tabs.length&&(this.tab_ix=t)}else if(this.$root.route.startsWith("#")){const t=this.$root.route.substr(1);this.dash_tabs.forEach(((e,s)=>{console.log(`Route match: ix=${s} title=${this.tabs[e].title} icon=${this.tabs[e].icon}`),t!=this.tabs[e].title&&t!=this.tabs[e].icon||(this.tab_ix=s)}))}const t=st(0,100);this.intvl=window.setInterval((()=>this.$store.insertData("$demo_random",t())),3e3)},beforeDestroy(){window.clearInterval(this.intvl)},provide(){const t=this;return{sendSrv(e,s){t.$refs.uib.send({topic:e,payload:s})}}},methods:{addTab(t){const e=this.$store.addTab(t);this.$nextTick((()=>{this.tab_ix=e,this.tab_edit=!0}))},deleteGrid(t,e){this.$store.deleteGrid(t,e)},reload(t){this.tab_ix=t,this.$forceUpdate()}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s(C,[t.gotConfig?s(E,{attrs:{app:"","mini-variant":"",clipped:""},model:{value:t.sidebar,callback:function(e){t.sidebar=e},expression:"sidebar"}},[t._e()]):t._e(),s(S,{attrs:{dense:"",app:"","clipped-left":"",color:"surface"}},[s("span",{staticClass:"hidden-sm-and-up"},[s($,{on:{click:function(e){t.sidebar=!t.sidebar}}})],1),s(O,{staticClass:"text-h4 font-weight-bold text--secondary flex-shrink-0 mr-3",staticStyle:{"font-variant":"small-caps"}},[t._v(" "+t._s(t.gotConfig?t.dash.title:"FlexDash")+" ")]),s("div",{staticClass:"version d-flex"},[t._v("alpha v0.1")]),t.gotConfig?s(T,{staticClass:"hidden-xs-only",attrs:{"icons-and-text":"","center-active":""},model:{value:t.tab_ix,callback:function(e){t.tab_ix=e},expression:"tab_ix"}},[t._l(t.dash_tabs,(function(e,n){return s(j,{key:e+n,class:{"is-active":n==t.tab_ix},attrs:{id:"tab-"+e}},[t._v(" "+t._s(t.tabs[e].title)+" "),s(m,{staticClass:"mb-0",attrs:{large:!t.tabs[e].title}},[t._v("mdi-"+t._s(t.tabs[e].icon))]),s("div",{staticStyle:{position:"absolute","z-index":"5",right:"0",top:"0.5ex"}},[t.$root.editMode&&n==t.tab_ix?s(l,{attrs:{small:"",icon:""},on:{click:function(e){e.stopPropagation(),t.tab_edit=!t.tab_edit}}},[s(m,{attrs:{small:""}},[t._v("mdi-pencil")])],1):t._e()],1)],1)})),t.$root.editMode?s(l,{staticClass:"my-auto ml-6",attrs:{"x-small":"",fab:"",id:"tab-add"},on:{click:function(e){e.stopPropagation(),t.tab_add=!t.tab_add}}},[s(m,[t._v("mdi-plus")])],1):t._e()],2):t._e(),s(_),t.$root.editMode?s(g,{attrs:{bottom:"",disabled:!t.canUndo},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,o=e.attrs;return[s(l,t._g(t._b({attrs:{icon:"",disabled:!t.canUndo},on:{click:function(e){return t.$store.performUndo()}}},"v-btn",o,!1),n),[s(m,[t._v("mdi-undo")])],1)]}}],null,!1,3463734905)},[s("span",[t._v("undo "+t._s(t.canUndo&&t.$store.undo.buf[t.$store.undo.buf.length-1].tagline))])]):t._e(),s("connections",{on:{src:function(e){t.config_src=e}}}),s(R,{attrs:{"offset-y":"","min-width":"10em"},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,o=e.attrs;return[s(l,t._g(t._b({attrs:{icon:""}},"v-btn",o,!1),n),[s(m,[t._v("mdi-cog")])],1)]}}]),model:{value:t.settings_menu,callback:function(e){t.settings_menu=e},expression:"settings_menu"}},[s(N,{attrs:{dense:""}},[s(D,[s(A,{attrs:{inset:"",label:"Edit"},model:{value:t.$root.editMode,callback:function(e){t.$set(t.$root,"editMode",e)},expression:"$root.editMode"}})],1),s(D,[s(A,{attrs:{inset:"",label:"Dark"},model:{value:t.$vuetify.theme.dark,callback:function(e){t.$set(t.$vuetify.theme,"dark",e)},expression:"$vuetify.theme.dark"}})],1)],1)],1)],1),s(R,{attrs:{"offset-y":"","allow-overflow":"",activator:"#tab-add"},model:{value:t.tab_add,callback:function(e){t.tab_add=e},expression:"tab_add"}},[s(N,{attrs:{dense:""}},[s(D,{on:{click:function(e){return t.addTab("grid")}}},[t._v("Grid with Widgets")]),s(D,{on:{click:function(e){return t.addTab("iframe")}}},[t._v("IFrame")])],1)],1),s(R,{attrs:{"offset-y":"","allow-overflow":"",activator:"#tab-"+t.tab_id,"max-width":"40ex","content-class":"popup-spacer","close-on-content-click":!1},model:{value:t.tab_edit,callback:function(e){t.tab_edit=e},expression:"tab_edit"}},[s("tab-edit",{attrs:{tab_ix:t.tab_ix,tab_id:t.tab_id},on:{reload:t.reload},model:{value:t.tab_edit,callback:function(e){t.tab_edit=e},expression:"tab_edit"}})],1),s(P,{style:{backgroundColor:t.$vuetify.theme.themes[t.theme].background}},[t.gotConfig?s(I,{class:t.tabs_items_class,attrs:{value:t.tab_ix}},t._l(t.dash_tabs,(function(e){return s(B,{key:e,ref:e,refInFor:!0,class:{"is-active":e==t.tab_id},style:{backgroundColor:t.$vuetify.theme.themes[t.theme].background}},t._l(t.tabs[e].grids,(function(n,o){return t.tabs[e].grids?s(t.grids[n].kind in t.palette.grids?t.grids[n].kind:"div",{key:n,tag:"component",attrs:{id:n},on:{delete:function(s){return t.deleteGrid(e,o)}}}):t._e()})),1)})),1):t._e(),t.gotConfig?s("div",{class:t.iframe_a_class},[t.iframe_a_src?s("iframe",{attrs:{src:t.iframe_a_src,frameborder:"0",marginheight:"0",marginwidth:"0"}}):t._e()]):t._e(),t.gotConfig?s("div",{class:t.iframe_b_class},[t.iframe_b_src?s("iframe",{attrs:{src:t.iframe_b_src,frameborder:"0",marginheight:"0",marginwidth:"0"}}):t._e()]):t._e(),t.gotConfig?t._e():s("div",[s(L,{staticStyle:{height:"400px"}},[s(F,{staticClass:"fill-height",attrs:{"align-content":"center",justify:"center"}},[s(M,{staticClass:"text-subtitle-1 text-center",attrs:{cols:"12"}},[t._v(" Loading configuration from"),s("br"),t._v(t._s(t.config_src)+" ")]),s(M,{attrs:{cols:"6"}},[s(q,{attrs:{color:"primary",indeterminate:"",rounded:"",height:"6"}})],1)],1)],1)],1)],1)],1)}),[],!1,(function(t){for(let e in mn)this[e]=mn[e]}),"38d9628a",null,null);bn.options.__file="src/dash.vue";var yn=bn.exports;h.config.productionTip=!1;const wn=h.observable({widgets:{},grids:{},count:0});function _n(t,e){for(const s in e)e[s]().then((e=>{const n=e.default.name;if(!n)throw Error(`Loading ${s} resulted in 'undefined'!?`);console.log(`Loaded ${n} from ${s}`),h.component(n,e.default),h.set(t,n,e.default)})).catch((t=>{console.log(`Error glob-loading ${s}:`,t)}))}_n(wn.widgets,{"/src/widgets/gauge.vue":()=>V((()=>import("./gauge.5990d141.js")),["/flexdash/assets/gauge.5990d141.js","/flexdash/assets/gauge.0b2e3fce.css","/flexdash/assets/vuetify.568efa99.js","/flexdash/assets/vuetify.cb43c61e.css","/flexdash/assets/vue.87a98c28.js"]),"/src/widgets/iframe.vue":()=>V((()=>import("./iframe.62bace4d.js")),["/flexdash/assets/iframe.62bace4d.js","/flexdash/assets/iframe.6b376242.css","/flexdash/assets/vue.87a98c28.js","/flexdash/assets/vuetify.568efa99.js","/flexdash/assets/vuetify.cb43c61e.css"]),"/src/widgets/markdown.vue":()=>V((()=>import("./markdown.1a9785c4.js")),["/flexdash/assets/markdown.1a9785c4.js","/flexdash/assets/md.63c1b924.js","/flexdash/assets/md.1a41a622.css","/flexdash/assets/vuetify.568efa99.js","/flexdash/assets/vuetify.cb43c61e.css","/flexdash/assets/vue.87a98c28.js"]),"/src/widgets/push-button.vue":()=>V((()=>import("./push-button.297b96f9.js")),["/flexdash/assets/push-button.297b96f9.js","/flexdash/assets/push-button.868d2fbe.css","/flexdash/assets/vuetify.568efa99.js","/flexdash/assets/vuetify.cb43c61e.css","/flexdash/assets/vue.87a98c28.js"]),"/src/widgets/random-array.vue":()=>V((()=>import("./random-array.3041e9f4.js")),["/flexdash/assets/random-array.3041e9f4.js","/flexdash/assets/vuetify.568efa99.js","/flexdash/assets/vuetify.cb43c61e.css","/flexdash/assets/vue.87a98c28.js"]),"/src/widgets/random-value.vue":()=>V((()=>import("./random-value.0d99bdae.js")),["/flexdash/assets/random-value.0d99bdae.js","/flexdash/assets/random-value.db7f20ba.css","/flexdash/assets/vuetify.568efa99.js","/flexdash/assets/vuetify.cb43c61e.css","/flexdash/assets/vue.87a98c28.js"]),"/src/widgets/sparkchart.vue":()=>V((()=>import("./sparkchart.9438e077.js")),["/flexdash/assets/sparkchart.9438e077.js","/flexdash/assets/vuetify.568efa99.js","/flexdash/assets/vuetify.cb43c61e.css","/flexdash/assets/vue.87a98c28.js"]),"/src/widgets/stat.vue":()=>V((()=>import("./stat.10728537.js")),["/flexdash/assets/stat.10728537.js","/flexdash/assets/vuetify.568efa99.js","/flexdash/assets/vuetify.cb43c61e.css","/flexdash/assets/vue.87a98c28.js"]),"/src/widgets/time-plot-raw.vue":()=>V((()=>import("./time-plot-raw.e157d215.js")),["/flexdash/assets/time-plot-raw.e157d215.js","/flexdash/assets/time-plot-raw.180d2306.css","/flexdash/assets/vue.87a98c28.js","/flexdash/assets/vuetify.568efa99.js","/flexdash/assets/vuetify.cb43c61e.css"]),"/src/widgets/time-plot.vue":()=>V((()=>import("./time-plot.92d04a2a.js")),["/flexdash/assets/time-plot.92d04a2a.js","/flexdash/assets/vue.87a98c28.js","/flexdash/assets/vuetify.568efa99.js","/flexdash/assets/vuetify.cb43c61e.css"]),"/src/widgets/toggle.vue":()=>V((()=>import("./toggle.35328f62.js")),["/flexdash/assets/toggle.35328f62.js","/flexdash/assets/vuetify.568efa99.js","/flexdash/assets/vuetify.cb43c61e.css","/flexdash/assets/vue.87a98c28.js"])}),_n(wn.grids,{"./grids/fixed-grid.vue":()=>V((()=>import("./fixed-grid.f2df8704.js")),["/flexdash/assets/fixed-grid.f2df8704.js","/flexdash/assets/fixed-grid.3c0f5a5a.css","/flexdash/assets/vuetify.568efa99.js","/flexdash/assets/vuetify.cb43c61e.css","/flexdash/assets/vue.87a98c28.js","/flexdash/assets/md.63c1b924.js","/flexdash/assets/md.1a41a622.css"]),"./grids/iframe-grid.vue":()=>V((()=>import("./iframe-grid.fac8dca0.js")),["/flexdash/assets/iframe-grid.fac8dca0.js","/flexdash/assets/iframe-grid.4e2fb72d.css","/flexdash/assets/vuetify.568efa99.js","/flexdash/assets/vuetify.cb43c61e.css","/flexdash/assets/vue.87a98c28.js"])});const vn=new h({vuetify:G,data:{editMode:!0,route:window.location.hash,params:new URL(document.location).searchParams,serverSend:null},provide:{$config:ht.config,$store:ht,palette:wn},render:t=>t(yn)}).$mount("#app");window.addEventListener("popstate",(()=>{const t=new URL(document.location).searchParams;console.log(`POP! hash=${window.location.hash} qstring=${t}`),vn.route=window.location.hash,vn.params=t})),vn.$mount("#app");export{H as n,st as r,it as w};
