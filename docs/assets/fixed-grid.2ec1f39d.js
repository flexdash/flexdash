import{h as t,k as i,e,f as s,t as o,i as n,b as l,j as r,B as a,l as d,_ as c,d as p,c as u,C as h,D as g,w as _,E as f,s as m,u as v,F as w,v as y,G as b}from"./vuetify.fdb6f834.js";import{n as k}from"./index.d7786540.js";import"./vue.1457ee3a.js";const $={name:"WidgetWrap",props:{suppressOutput:{type:Boolean,default:!0},color:{type:String,default:void 0},config:{type:Object,required:!0}},data:()=>({watchers:[],bindings:{}}),computed:{title(){return this.bindings.title||"--"},child_props(){const t=this.palette.widgets;return this.config.kind in t&&t[this.config.kind].props||{}}},watch:{config:{immediate:!0,deep:!0,handler(t){this.genBindings(t)}}},inject:["$store","palette"],methods:{addDynBinding(t,i){const e=this;i in this.$store.sd||e.$set(this.$store.sd,i,void 0);return this.$watch((()=>e.$store.sd[i]),(i=>{e.updateBindingValue(t,i)}),{deep:!0,immediate:!0})},removeWatchers(){this.watchers.forEach((t=>{t()})),this.watchers.length=0},genBindings(t){this.removeWatchers(),this.bindings={},t&&(Object.keys(t.static||{}).forEach((i=>{void 0!==t.static[i]&&this.$set(this.bindings,i,t.static[i])})),Object.keys(t.dynamic||{}).forEach((i=>{void 0!==t.dynamic[i]&&this.watchers.push(this.addDynBinding(i,t.dynamic[i]))})))},updateBindingValue(t,i){if(!(t in this.child_props))return void console.log(`Warning: updating value for ${t}, but ${this.config.kind} has no ${t}:`,JSON.stringify(this.child_props));let e=this.child_props[t].type;if(e===Boolean)"number"==typeof i?i=!!i:"string"==typeof i?(i=i.toLowerCase(),i=["true","ok","1","yes"].includes(i)):"boolean"!=typeof i&&(i=void 0);else if(e===Number)"string"==typeof i?i=parseFloat(i):"boolean"==typeof i?i=i?1:0:"number"!=typeof i&&(i=void 0),void 0!==i&&(i=Number.parseFloat(i.toPrecision(4)));else if(e===String)typeof i===Number?i=i.toString():typeof i!==String&&(i=JSON.stringify(i));else if((e===Array||e===Object)&&"string"==typeof i)try{i=JSON.parse(i)}catch(s){i=void 0,console.log(`Cannot convert string value for ${t} to ${e.name}`)}this.$set(this.bindings,t,i)},handleEdit(){console.log("handleEdit() in widget-wrap"),this.$emit("edit","toggle")},sendData(t){const i=this.config.output;!this.suppressOutput&&i?console.log(`Widget ${this.config.kind}[${this.config.id}] sending ${i} <-`,t):console.log(`Output of widget ${this.config.kind}[${this.config.id}] suppressed`)}}},x={};var C=k($,(function(){var o=this,n=o.$createElement,l=o._self._c||n;return l(t,{attrs:{color:o.color}},["title"in o.child_props?o.$root.editMode?l("div",{attrs:{"display:content":""}},[l("div",{staticStyle:{position:"absolute","z-index":"5",right:"0",top:"0.5ex"}},[l(e,{staticClass:"justify-end align-start mt-n1",attrs:{small:"",icon:""},on:{click:o.handleEdit}},[l(s,{attrs:{small:""}},[o._v("mdi-pencil")])],1)],1)]):o._e():l(i,{staticClass:"d-flex pa-0 pt-1 mb-n1"},[o.title?l("span",{staticClass:"mx-auto"},[o._v(o._s(o.title))]):o._e(),o.$root.editMode?l(e,{staticClass:"justify-end align-start mt-n1",attrs:{small:"",icon:""},on:{click:o.handleEdit}},[l(s,{attrs:{small:""}},[o._v("mdi-pencil")])],1):o._e()],1),l(o.config.kind,o._b({ref:"comp",tag:"component",on:{send:function(t){return o.sendData(t)}}},"component",o.bindings,!1))],1)}),[],!1,(function(t){for(let i in x)this[i]=x[i]}),"54661580",null,null);C.options.__file="src/components/widget-wrap.vue";const S={name:"WidgetEdit",components:{WidgetWrap:C.exports},inject:["$store","palette"],props:{id:{type:String,required:!0},grid_id:{type:String,require:!0},edit_active:{type:Boolean,default:!1}},data:()=>({suppressOutput:!0,prop_static:{},saved_widget:null,reposition:!0,edit_help:!1}),computed:{widget(){return this.$store.widgetByID(this.id)},sdKeys(){return Object.keys(this.$store.sd).sort()},edit_props(){return Object.keys(this.child_props).filter((t=>"title"!==t)).sort()},prop_info(){const t={String:"mdi-format-quote-close",Number:"mdi-numeric",Boolean:"mdi-yin-yang",Array:"mdi-code-brackets",Object:"mdi-code-braces"};let i={};const e=this.child_props;for(let s in e){let o=e[s].type||String;[String,Number,Boolean,Array,Object].includes(o)||(o=String);let n=o.name;void 0!==e[s].default&&(n+=`, default: ${e[s].default}`);let l=t[o.name];i[s]={type:o,default:e[s].default,validator:e[s].validator,hint:n,icon:l}}return i},child_props(){const t=this.palette.widgets;return this.widget.kind in t&&t[this.widget.kind].props||{}},child_help(){const t=this.palette.widgets;if(this.widget.kind in t)return t[this.widget.kind].help},child_help_title(){return this.child_help?this.child_help.replace(/[.\n].*/s,""):null},child_help_text(){return this.child_help?this.child_help.replace(/^.*?[.\n]\s/s,""):null},widgetStyle(){return`${`grid-row-start: span ${this.widget.rows||1}`}; ${`grid-column-start: span ${this.widget.cols||1}`};`}},watch:{edit_active(t){if(t){this.saved_widget=this.widget;let t=this;this.prop_static=Object.fromEntries(Object.keys(t.child_props).map((i=>[i,1-(i in t.widget.dynamic)])))}else this.saved_widget=null}},methods:{propVal(t){return void 0!==this.widget.static[t]?this.widget.static[t]:this.prop_info[t].default},toggleEdit(){this.$emit("edit",!this.edit_active)},endEdit(){this.$emit("edit",!1)},handleEdit(t,i,e){if(t in this.widget){if("title"!=i){if(!(i in this.child_props))return;this.child_props[i].type===Number&&"string"==typeof e&&(e=Number.parseFloat(e))}this.$store.updateWidgetProp(this.id,t,i,e)}},adjustRows(t){const i=this.widget;i.rows=(i.rows||1)+t,i.rows<1&&(i.rows=1),i.rows>16&&(i.rows=16),this.reposition=!1,this.$nextTick((()=>{this.reposition=!0}))},adjustCols(t){const i=this.widget;i.cols=(i.cols||1)+t,i.cols<1&&(i.cols=1),i.cols>16&&(i.cols=16),this.reposition=!1,this.$nextTick((()=>{this.reposition=!0}))},moveWidget(t){this.$emit("move",t),this.reposition=!1,this.$nextTick((()=>{this.reposition=!0}))}}},E={};var j=k(S,(function(){var f=this,m=f.$createElement,v=f._self._c||m;return v("div",{style:f.widgetStyle},[v(o,{attrs:{value:f.edit_active&&f.reposition,"offset-y":"","allow-overflow":"","min-width":"80%","content-class":"popup-spacer","close-on-content-click":!1,"close-on-click":!1},scopedSlots:f._u([{key:"activator",fn:function(t){return[v("widget-wrap",{attrs:{config:f.widget,suppressOutput:f.suppressOutput,color:f.edit_active?"highlight":"","not-used":t},on:{edit:f.toggleEdit}})]}}])},[v(t,{attrs:{color:"panel"}},[v(n,{staticClass:"d-flex align-baseline pb-6"},[v("span",[f._v("Edit "+f._s(f.widget.kind)+" widget")]),v(l,{staticClass:"ml-3 mt-0 text-h6 flex-grow-0",attrs:{dense:"",value:f.widget.static.title,"hide-details":!0},on:{input:function(t){return f.handleEdit("static","title",t)}}}),v(r),v(e,{attrs:{elevation:"0",icon:""},on:{click:f.endEdit}},[v(s,[f._v("mdi-close")])],1)],1),f.child_help?v(i,{staticClass:"pb-0"},[f.child_help_title?v("h3",[f._v(f._s(f.child_help_title)+" "),f.child_help_text?v(e,{staticClass:"ml-3",attrs:{"x-small":"",flat:"",text:"",value:f.edit_help},on:{click:function(t){f.edit_help=!f.edit_help}}},[f._v(" "+f._s(f.edit_help?"less...":"more..."))]):f._e()],1):f._e(),f.edit_help?v("div",{staticClass:"md"},[f._v(f._s(f.child_help_text))]):f._e()]):f._e(),f.edit_active?v(i,[v(a,{staticClass:"pa-0",attrs:{fluid:""}},[v(d,{attrs:{align:"center"}},[v(c,{staticClass:"d-flex",attrs:{cols:"6",sm:"4"}},[v(e,{attrs:{small:""},on:{click:function(t){return f.$emit("delete")}}},[f._v("Delete widget")])],1),v(c,{staticClass:"d-flex",attrs:{cols:"6",sm:"2"}},[v(p,{attrs:{bottom:""},scopedSlots:f._u([{key:"activator",fn:function(t){var i=t.on;return[v(e,f._g({staticClass:"ml-2",attrs:{small:"",icon:""},on:{click:function(t){return f.moveWidget(-1)}}},i),[v(s,[f._v("mdi-arrow-up-bold")])],1)]}}],null,!1,4110266859)},[v("span",[f._v("Move widget towards the top-left of the grid")])]),v(p,{attrs:{bottom:""},scopedSlots:f._u([{key:"activator",fn:function(t){var i=t.on;return[v(e,f._g({attrs:{small:"",icon:""},on:{click:function(t){return f.moveWidget(1)}}},i),[v(s,[f._v("mdi-arrow-down-bold")])],1)]}}],null,!1,171324591)},[v("span",[f._v("Move widget towards the bottom-right of the grid")])])],1),v(c,{staticClass:"d-flex",attrs:{cols:"12",sm:"6",md:"4"}},[v(e,{staticClass:"ml-2",attrs:{small:"",icon:""},on:{click:function(t){return f.adjustRows(-1)}}},[v(s,[f._v("mdi-minus")])],1),v(u,{attrs:{small:""}},[f._v(f._s(f.widget.rows)+" row"+f._s(f.widget.rows>1?"s":""))]),v(e,{attrs:{small:"",icon:""},on:{click:function(t){return f.adjustRows(1)}}},[v(s,[f._v("mdi-plus")])],1),v(e,{staticClass:"ml-2",attrs:{small:"",icon:""},on:{click:function(t){return f.adjustCols(-1)}}},[v(s,[f._v("mdi-minus")])],1),v(u,{attrs:{small:""}},[f._v(f._s(f.widget.cols)+" col"+f._s(f.widget.cols>1?"s":""))]),v(e,{attrs:{small:"",icon:""},on:{click:function(t){return f.adjustCols(1)}}},[v(s,[f._v("mdi-plus")])],1)],1)],1),v(d,{attrs:{align:"center"}},f._l(f.edit_props,(function(t){return v(c,{key:t,staticClass:"d-flex",attrs:{cols:"12",sm:"6",md:"4"}},[v(p,{attrs:{bottom:""},scopedSlots:f._u([{key:"activator",fn:function(i){var o=i.on,n=i.attrs;return[v(h,{staticClass:"mt-2 mr-1",attrs:{mandatory:"",dense:"","background-color":"rgba(0,0,0,0)",color:"primary"},model:{value:f.prop_static[t],callback:function(i){f.$set(f.prop_static,t,i)},expression:"prop_static[prop]"}},[v(e,f._g(f._b({attrs:{"x-small":"",icon:""}},"v-btn",n,!1),o),[v(s,[f._v("mdi-link-variant")])],1),v(e,f._g(f._b({attrs:{"x-small":"",icon:""}},"v-btn",n,!1),o),[v(s,[f._v(f._s(f.prop_info[t].icon))])],1)],1)]}}],null,!0)},[v("span",[f._v("Toggle dynamic link vs. literal value")])]),f.prop_static[t]?f.prop_info[t].type===Number?v(l,{attrs:{label:t,type:"number",dense:"",hint:f.prop_info[t].hint,value:f.propVal(t)},on:{input:function(i){return f.handleEdit("static",t,i)}}}):f.prop_info[t].type===Boolean?v(_,{staticClass:"mt-0 ml-2",attrs:{label:t,hint:f.prop_info[t].hint,"input-value":f.propVal(t)},on:{change:function(i){return f.handleEdit("static",t,i)}}}):f.prop_info[t].type===Array?v(l,{attrs:{label:t,dense:"",value:f.widget.static[t]||f.prop_info[t].default},on:{input:function(i){return f.handleEdit("static",t,i)}}}):(f.prop_info[t].type,v(l,{attrs:{label:t,dense:"",hint:f.prop_info[t].hint,value:f.widget.static[t]||f.prop_info[t].default},on:{input:function(i){return f.handleEdit("static",t,i)}}})):v(g,{attrs:{label:t,clearable:"",dense:"","persistent-hint":"",hint:"variable pathname (/-sep)",items:f.sdKeys,value:f.widget.dynamic[t]},on:{input:function(i){return f.handleEdit("dynamic",t,i)}}})],1)})),1)],1)],1):f._e()],1)],1)],1)}),[],!1,(function(t){for(let i in E)this[i]=E[i]}),"20b286b9",null,null);j.options.__file="src/components/widget-edit.vue";var W=j.exports;const O={};var B=k({name:"FixedGrid",components:{WidgetEdit:W},inject:["$store","$config","palette"],props:{id:{type:String}},data:()=>({add_menu:null,edit_ix:null,rolledup:!1}),computed:{grid(){return this.$store.gridByID(this.id)},rollupMini(){return!this.$root.editMode&&!this.grid.title},rollupMaxi(){return!this.$root.editMode&&this.grid.title},rollerClasses(){return["d-flex","roller",this.grid.widgets.length>0&&!this.rolledup&&"roller__minimal"]},widgets(){return console.log("Palette:",this.palette.widgets),Object.keys(this.palette.widgets)}},methods:{toggleEdit(t,i){this.edit_ix=i?t:null},addWidget(t){const i=this.$store.addWidget(this.id,t);this.edit_ix=i},deleteWidget(t){this.$store.deleteWidget(this.id,t),this.endEdit()},moveWidget(t,i){if(console.log(`Moving widget #${t} by ${i}`),!(t+i>=0&&t+i<this.grid.widgets.length))return;let e=[...this.grid.widgets],s=e[t];e[t]=e[t+i],e[t+i]=s,this.$store.updateGrid(this.id,{widgets:e}),this.edit_ix+=i},toggleRoll(){this.rolledup=!this.rolledup},changeTitle(t){this.$store.updateGrid(this.id,{title:t})}}},(function(){var t=this,i=t.$createElement,n=t._self._c||i;return n("div",{staticStyle:{display:"contents"}},[t.rollupMini?n("div",{class:t.rollerClasses},[n(p,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(i){var o=i.on;return[n(e,t._g({staticClass:"mx-auto",attrs:{"x-small":"",icon:"",height:"24px"},on:{click:t.toggleRoll}},o),[n(s,[t._v("mdi-arrow-"+t._s(t.rolledup?"down":"up")+"-drop-circle")])],1)]}}],null,!1,3656355880)},[n("span",[t._v("Roll widgets up/down")])])],1):t._e(),t.rollupMaxi?n(f,{staticClass:"d-flex justify-start",attrs:{dense:"",flat:"",height:"36",color:"background"}},[n(p,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(i){var o=i.on;return[n(e,t._g({staticClass:"mx-auto",attrs:{"x-small":"",icon:"",height:"24px"},on:{click:t.toggleRoll}},o),[n(s,[t._v("mdi-arrow-"+t._s(t.rolledup?"down":"up")+"-drop-circle")])],1)]}}],null,!1,3656355880)},[n("span",[t._v("Roll widgets up/down")])]),n(m,[t._v(t._s(t.grid.title))])],1):t._e(),t.$root.editMode?n(f,{staticClass:"editmode",attrs:{dense:"",flat:"",color:"background"}},[n(p,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(i){var o=i.on;return[n(e,t._g({staticClass:"mr-4",attrs:{small:"",icon:"",color:"grey"},on:{click:t.toggleRoll}},o),[n(s,[t._v("mdi-arrow-"+t._s(t.rolledup?"down":"up")+"-drop-circle")])],1)]}}],null,!1,527658409)},[n("span",[t._v("Roll widgets up/down")])]),n(p,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(i){var e=i.on;return[n(l,t._g({staticClass:"mr-6 flex-grow-0",staticStyle:{width:"20ex"},attrs:{"single-line":"",dense:"","hide-details":"",label:"title",value:t.grid.title},on:{change:t.changeTitle}},e))]}}],null,!1,529640478)},[n("span",[t._v("Title to show at top of grid, if empty the grid bar is thinner")])]),n("div",[n(o,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(i){var o=i.on,l=i.attrs;return[n(p,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(i){var r=i.on;return[n(e,t._g(t._b({attrs:{small:"",icon:"",color:"primary"}},"v-btn",l,!1),Object.assign({},r,o)),[n(s,[t._v("mdi-card-plus")])],1)]}}],null,!0)},[n("span",[t._v("Add a widget to the end of the grid")])])]}}],null,!1,4148765622),model:{value:t.add_menu,callback:function(i){t.add_menu=i},expression:"add_menu"}},[n(v,[n(w,[t._v("Add Widget to the end of the grid")]),t._l(t.widgets,(function(i){return n(y,{key:i,on:{click:function(e){return t.addWidget(i)}}},[n(b,[t._v(t._s(i))])],1)}))],2)],1)],1),n(r),n(p,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(i){var s=i.on;return[n(e,t._g({staticClass:"mc-auto",attrs:{small:""},on:{click:function(i){return t.$emit("delete")}}},s),[t._v(" Delete grid ")])]}}],null,!1,1535469378)},[n("span",[t._v("Delete this grid and all its widgets")])])],1):t._e(),t.rolledup?t._e():n(a,{staticClass:"g-grid-small pt-0",attrs:{fluid:""}},t._l(t.grid.widgets,(function(i,e){return n("widget-edit",{key:i,attrs:{id:i,grid_id:t.id,edit_active:e==t.edit_ix},on:{edit:function(i){return t.toggleEdit(e,i)},move:function(i){return t.moveWidget(e,i)},delete:function(i){return t.deleteWidget(e)}}})})),1)],1)}),[],!1,(function(t){for(let i in O)this[i]=O[i]}),"3d60fe94",null,null);B.options.__file="src/grids/fixed-grid.vue";var M=B.exports;export default M;
