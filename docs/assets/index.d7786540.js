var t=Object.defineProperty,e=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(e,n,o)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,a=(t,e)=>{for(var n in e||(e={}))i.call(e,n)&&r(t,n,e[n]);if(o)for(var n of o(e))s.call(e,n)&&r(t,n,e[n]);return t},c=(t,o)=>e(t,n(o));import{V as l}from"./vue.1457ee3a.js";import{V as d,_ as u,a as h,b as f,c as p,d as g,e as b,f as _,g as m,h as v,i as y,j as w,k as j,l as x,m as $,n as k,o as O,p as E,q as S,r as C,s as D,t as I,u as T,v as A,w as P,x as L,y as M,z as N}from"./vuetify.fdb6f834.js";let R;const F={},U=function(t,e){if(!e)return t();if(void 0===R){const t=document.createElement("link").relList;R=t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(e.map((t=>{if(t in F)return;F[t]=!0;const e=t.endsWith(".css"),n=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${n}`))return;const o=document.createElement("link");return o.rel=e?"stylesheet":R,e||(o.as="script",o.crossOrigin=""),o.href=t,document.head.appendChild(o),e?new Promise(((t,e)=>{o.addEventListener("load",t),o.addEventListener("error",e)})):void 0}))).then((()=>t()))};l.use(d);var B=new d({theme:{options:{variations:!1,customProperties:!0},themes:{light:{background:"#f7f5f5",surface:"#fffdfd",panel:"#f4f2f2",primary:"#ad1625",primary_light:"#e5504d",primary_dark:"#760000",error:"#ec7422",highlight:"#fff5ce"},dark:{background:"#0b0808",surface:"#201d1d",panel:"#262424",primary:"#ad1625",primary_light:"#e5504d",primary_dark:"#760000",error:"#ec7422",highlight:"#716741"}}}});function G(t,e,n,o,i,s,r,a){var c,l="function"==typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=n,l._compiled=!0),o&&(l.functional=!0),s&&(l._scopeId="data-v-"+s),r?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},l._ssrRegister=c):i&&(c=a?function(){i.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:i),c)if(l.functional){l._injectStyles=c;var d=l.render;l.render=function(t,e){return c.call(e),d(t,e)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,c):[c]}return{exports:t,options:l}}const W={};var q=G({name:"DemoSettings",props:{connection:null,config:{type:Object,default:()=>({enabled:!1})}},computed:{last_msg(){if(!this.config.enabled)return"- disabled -";if(!this.connection||!this.connection.data.last_msg.topic)return"- none -";const t=JSON.stringify(this.connection.data.last_msg.payload);return`"${this.connection.data.last_msg.topic}" <- ${t}`}},methods:{handleEnable(t){this.config.enabled=t,this.connection&&(t?this.connection.start():this.connection.stop())}}},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(u,{attrs:{cols:"12",md:"5"}},[n("h3",[t._v("Demo")]),t._v(" Generate random demo data. "),n(h,{attrs:{label:"enabled","hide-details":"","input-value":t.config.enabled},on:{change:t.handleEnable}}),n(f,{attrs:{disabled:"","persistent-hint":"",hint:"last message generated",value:t.last_msg}})],1)}),[],!1,(function(t){for(let e in W)this[e]=W[e]}),null,null,null);q.options.__file="src/connections/demo-settings.vue";var z=q.exports;const V=["kitchen","bedroom","study","living room","guest room"],X=(()=>{let t={};return e=>{let[n,o,i,s]=t[e]||[70,0,0,0];function r(){let t;if(o)t=s*i;else{let e;do{e=2*Math.random()-1,s=2*Math.random()-1,i=e*e+s*s}while(i>=1);i=Math.sqrt(-2*Math.log(i)/i),t=e*i}return o^=1,t}let a;do{a=r()}while(n+a<50||n+a>90);return n+=a,t[e]=[n,o,i,s],n}})(),J={dash:{title:"FlexDash",tabs:["t00000","t00001"]},conn:{demo:{enabled:!0},websock:{enabled:!1,address:""}},tabs:{t00000:{id:"t00000",icon:"view-dashboard",grids:["g0"]},t00001:{id:"t00001",icon:"home-thermometer",grids:["g1","g2"]}},grids:{g0:{id:"g0",kind:"FixedGrid",widgets:["1","0","3","2","9","6","7","8","10","11","12","13","14"]},g1:{id:"g1",kind:"FixedGrid",widgets:[]},g2:{id:"g2",kind:"FixedGrid",widgets:[]}},widgets:{1:{kind:"Markdown",id:"1",cols:3,rows:5,dynamic:{},static:{title:"",text:"\n# Welcome to FlexDash\n\nYou are seeing the FlexDash demo dashboard. It shows a variety of _widgets_ spread across\nmultiple _tabs_. Each tab can have multiple _grids_ that lay out the widgets and that can be\nrolled up and down.\n\n### Getting started\n\nThe demo dashboard does not connect to any server and instead displays randomly generated data.\nTo connect to a server, use the _mdi-network_ icon at the top right (not implemented yet).\n\nTo edit the dashboard's configuration, switch to edit mode using the settings icon at\nthe top-right. All editing is instantaneous while the dashboard remains live. If you make\na mistake, use the undo button at the top right.\n\n### Feeding data into FlexDash\n\n_to be continued_ ...\n"}},0:{kind:"Stat",id:"0",static:{title:"Bedroom",value:"cold",unit:"F"},dynamic:{value:"bedroom"},rows:1,cols:1},2:{kind:"Stat",id:"2",static:{title:"Guest Room",unit:"F"},dynamic:{value:"guest room"},rows:1,cols:1},3:{kind:"Gauge",id:"3",static:{title:"Living Room",value:50,arc:270,center:!0,unit:"F",needle_color:"red",min:30},dynamic:{value:"living room"},rows:2,cols:2},6:{kind:"Gauge",id:"6",static:{title:"Kitchen",color:"lightblue",arc:90,unit:"F",min:0},dynamic:{value:"kitchen"},rows:1,cols:1},7:{kind:"Toggle",id:"7",static:{title:"light",off_value:"0",on_value:"ON",color:"secondary",value:"ON"},dynamic:{_output:"light",value:"light"},rows:1,cols:1},8:{kind:"PushButton",id:"8",static:{title:"launch",color:"secondary",output_value:"ON",icon:"rocket-launch",tooltip:"Next stop: Mars!"},dynamic:{_output:"light"},rows:1,cols:1},9:{kind:"PushButton",id:"9",static:{title:"",icon:"watering-can"},dynamic:{},rows:1,cols:1},10:{kind:"Gauge",id:"10",static:{title:"Kitchen",arc:180,base_color:"lightgreen",color:"blue",unit:"F",radius:90,needle_color:"white"},dynamic:{value:"kitchen"},rows:1,cols:1},11:{kind:"Sparkchart",id:"11",static:{title:"Livingrm",color:"green",line_width:4,fill:!0},dynamic:{value:"living room"},rows:1,cols:1},12:{kind:"Sparkchart",id:"12",static:{title:"Living Room",bars:!0},dynamic:{value:"living room"},rows:1,cols:1},13:{kind:"Sparkchart",id:"13",static:{title:"Kitchen"},dynamic:{value:"kitchen"},rows:1,cols:2},14:{kind:"TimePlot",id:"14",static:{title:"Temperatures"},dynamic:{data:"temp_data",options:"temp_opts"},rows:4,cols:4}}},Q={series:[{label:"time"},{label:"Sensor 1",scale:"C",value:"v.toFixed(1) + '°C'"},{label:"Sensor 2",scale:"C",value:"v.toFixed(1) + '°C'"},{label:"Sensor 3",scale:"C",value:"v.toFixed(1) + '°C'"}],axes:[{},{scale:"F",values:'vv.map(v => v + "°F")'},{scale:"C",values:'vv.map(v => v + "°C")',side:1,grid:{show:!1}}],scales:{F:{from:"C",range:"[ min*9/5+32, max*9/5+32 ]"}}};class K{constructor(t,e){return this.serverSend=t,this.storeInsert=e,this.active=!1,this.timers=[],this.data=l.observable({last_msg:{topic:null,payload:null},status:"off"}),this}start(){this.active=!0,this.storeInsert({topic:"$config",payload:J});for(let t=0;t<V.length;t++)this.timers.push(window.setInterval((()=>this.tick(V[t])),5e3+1e3*t)),this.tick(V[t]);this.storeInsert({topic:"temp_opts",payload:Q}),this.timers.push(window.setInterval((()=>this.plot),3e3)),this.plot(),this.data.status="ok"}stop(){this.timers.map((t=>window.clearInterval(t))),this.timer=[],this.active=!1,this.data.last_msg.topic=null,this.data.status="off"}send(t){l.set(this.data,"last_msg",t),this.storeInsert(t)}tick(t){const e=Math.round(10*X(t))/10;this.send({topic:`${t}`,payload:e})}plot(){let t=[Date.now()/1e3,Math.round(10*X("p1"))/10,Math.round(10*X("p2"))/10,Math.round(10*X("p3"))/10];this.storeInsert({topic:"temp_data",payload:t})}}const Y={};var H=G({name:"WebsockSettings",props:{connection:null,config:{type:Object,default:()=>({enabled:!1,address:""})}},created(){console.log("ws-settings created, config:",JSON.stringify(this.config),"connection:",JSON.stringify(this.connection))},computed:{last_msg(){if(!this.config.enabled)return"- disabled -";if(!this.connection||!this.connection.data.last_msg.topic)return"- none -";const t=JSON.stringify(this.connection.data.last_msg.payload);return`"${this.connection.data.last_msg.topic}" <- ${t}`},status_txt(){return console.log("status_txt, this.config:",this.config),this.config.enabled&&this.connection?this.connection.data.status_txt:"disabled"},status_color(){return this.config.enabled&&this.connection?"ok"==this.connection.data.status?"success":"bad"==this.connection.data.status?"error":"grey":"grey"},disable(){return!this.connection}},methods:{handleEnabled(t){this.config.enabled=t,t?(console.log("WS now enabled, addr:",this.config),this.connection.start(this.config.address)):(console.log("WS now disabled"),this.connection.stop())},handleAddress(t){this.config.address=t,this.config.enabled&&(console.log("WS: address changed, reconnecting"),this.connection.stop(),this.connection.start(this.config.address))},validateAddress:t=>t.match(/^(ws|http)s?:[/][/]/)?!!t.match(/^(ws|http)s?:[/][/][^/]+\//)||"address must contain hostname and path":"address must start with ws:// or wss://"}},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(u,{attrs:{cols:"12",md:"5"}},[n("div",{staticStyle:{width:"100%",display:"flex","justify-content":"space-between","align-items":"baseline"}},[n("h3",[t._v("Websocket")]),n(p,{attrs:{small:"",color:t.status_color}},[t._v(t._s(t.status_txt))])],1),n(h,{attrs:{label:"enabled",disabled:t.disable,"input-value":t.config.enabled,"hide-details":""},on:{change:t.handleEnabled}}),n(f,{attrs:{label:"websocket server address","persistent-hint":"",clearable:"",value:t.config.address,rules:[t.validateAddress],hint:"wss://server.example.com/mydash, ws://localhost:1880/ws/fd"},on:{change:t.handleAddress}}),n(f,{attrs:{disabled:"","persistent-hint":"",hint:"last message received",value:t.last_msg}})],1)}),[],!1,(function(t){for(let e in Y)this[e]=Y[e]}),null,null,null);H.options.__file="src/connections/websock-settings.vue";var Z=H.exports,tt=function(t,e){return(tt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function et(t,e){function n(){this.constructor=t}tt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function nt(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,i,s=n.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(o=s.next()).done;)r.push(o.value)}catch(a){i={error:a}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return r}function ot(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(nt(arguments[e]));return t}var it=function(t,e){this.target=e,this.type=t},st=function(t){function e(e,n){var o=t.call(this,"error",n)||this;return o.message=e.message,o.error=e,o}return et(e,t),e}(it),rt=function(t){function e(e,n,o){void 0===e&&(e=1e3),void 0===n&&(n="");var i=t.call(this,"close",o)||this;return i.wasClean=!0,i.code=e,i.reason=n,i}return et(e,t),e}(it),at={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},ct=function(){function t(t,e,n){var o=this;void 0===n&&(n={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(t){o._debug("open event");var e=o._options.minUptime,n=void 0===e?at.minUptime:e;clearTimeout(o._connectTimeout),o._uptimeTimeout=setTimeout((function(){return o._acceptOpen()}),n),o._ws.binaryType=o._binaryType,o._messageQueue.forEach((function(t){return o._ws.send(t)})),o._messageQueue=[],o.onopen&&o.onopen(t),o._listeners.open.forEach((function(e){return o._callEventListener(t,e)}))},this._handleMessage=function(t){o._debug("message event"),o.onmessage&&o.onmessage(t),o._listeners.message.forEach((function(e){return o._callEventListener(t,e)}))},this._handleError=function(t){o._debug("error event",t.message),o._disconnect(void 0,"TIMEOUT"===t.message?"timeout":void 0),o.onerror&&o.onerror(t),o._debug("exec error listeners"),o._listeners.error.forEach((function(e){return o._callEventListener(t,e)})),o._connect()},this._handleClose=function(t){o._debug("close event"),o._clearTimeouts(),o._shouldReconnect&&o._connect(),o.onclose&&o.onclose(t),o._listeners.close.forEach((function(e){return o._callEventListener(t,e)}))},this._url=t,this._protocols=e,this._options=n,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(t,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CONNECTING",{get:function(){return t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OPEN",{get:function(){return t.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSING",{get:function(){return t.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSED",{get:function(){return t.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){return this._messageQueue.reduce((function(t,e){return"string"==typeof e?t+=e.length:e instanceof Blob?t+=e.size:t+=e.byteLength,t}),0)+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?t.CLOSED:t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),t.prototype.close=function(t,e){void 0===t&&(t=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),this._ws?this._ws.readyState!==this.CLOSED?this._ws.close(t,e):this._debug("close: already closed"):this._debug("close enqueued: no ws instance")},t.prototype.reconnect=function(t,e){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED?(this._disconnect(t,e),this._connect()):this._connect()},t.prototype.send=function(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{var e=this._options.maxEnqueuedMessages,n=void 0===e?at.maxEnqueuedMessages:e;this._messageQueue.length<n&&(this._debug("enqueue",t),this._messageQueue.push(t))}},t.prototype.addEventListener=function(t,e){this._listeners[t]&&this._listeners[t].push(e)},t.prototype.dispatchEvent=function(t){var e,n,o=this._listeners[t.type];if(o)try{for(var i=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}(o),s=i.next();!s.done;s=i.next()){var r=s.value;this._callEventListener(t,r)}}catch(a){e={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return!0},t.prototype.removeEventListener=function(t,e){this._listeners[t]&&(this._listeners[t]=this._listeners[t].filter((function(t){return t!==e})))},t.prototype._debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._options.debug&&console.log.apply(console,ot(["RWS>"],t))},t.prototype._getNextDelay=function(){var t=this._options,e=t.reconnectionDelayGrowFactor,n=void 0===e?at.reconnectionDelayGrowFactor:e,o=t.minReconnectionDelay,i=void 0===o?at.minReconnectionDelay:o,s=t.maxReconnectionDelay,r=void 0===s?at.maxReconnectionDelay:s,a=0;return this._retryCount>0&&(a=i*Math.pow(n,this._retryCount-1))>r&&(a=r),this._debug("next delay",a),a},t.prototype._wait=function(){var t=this;return new Promise((function(e){setTimeout(e,t._getNextDelay())}))},t.prototype._getNextUrl=function(t){if("string"==typeof t)return Promise.resolve(t);if("function"==typeof t){var e=t();if("string"==typeof e)return Promise.resolve(e);if(e.then)return e}throw Error("Invalid URL")},t.prototype._connect=function(){var t=this;if(!this._connectLock&&this._shouldReconnect){this._connectLock=!0;var e=this._options,n=e.maxRetries,o=void 0===n?at.maxRetries:n,i=e.connectionTimeout,s=void 0===i?at.connectionTimeout:i,r=e.WebSocket,a=void 0===r?function(){if("undefined"!=typeof WebSocket)return WebSocket}():r;if(this._retryCount>=o)this._debug("max retries reached",this._retryCount,">=",o);else{if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),void 0===(c=a)||!c||2!==c.CLOSING)throw Error("No valid WebSocket class provided");var c;this._wait().then((function(){return t._getNextUrl(t._url)})).then((function(e){t._closeCalled||(t._debug("connect",{url:e,protocols:t._protocols}),t._ws=t._protocols?new a(e,t._protocols):new a(e),t._ws.binaryType=t._binaryType,t._connectLock=!1,t._addListeners(),t._connectTimeout=setTimeout((function(){return t._handleTimeout()}),s))}))}}},t.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new st(Error("TIMEOUT"),this))},t.prototype._disconnect=function(t,e){if(void 0===t&&(t=1e3),this._clearTimeouts(),this._ws){this._removeListeners();try{this._ws.close(t,e),this._handleClose(new rt(t,e,this))}catch(n){}}},t.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},t.prototype._callEventListener=function(t,e){"handleEvent"in e?e.handleEvent(t):e(t)},t.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},t.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},t.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},t}();class lt{constructor(t,e){return this.sendMsg=t,this.recvMsg=e,this.rws=null,this.data=l.observable({last_msg:{topic:null,payload:null},status:"off",status_txt:"off"}),this}start(t){console.log("WS: connecting to",t),this.data.status="bad",this.data.status_txt="connecting",this.rws=new ct(t,[],{debug:!0,startClosed:!0}),this.rws.addEventListener("open",(()=>this.onOpen())),this.rws.addEventListener("close",(()=>this.onClose())),this.rws.addEventListener("message",(t=>this.onMessage(t))),this.rws.addEventListener("error",(t=>this.onError(t))),this.rws.reconnect()}stop(){this.rws&&(console.log("WS: closing"),this.rws.close()),this.rws=null,this.data.status="off",this.data.status_txt="off"}onOpen(){console.log("WS opened"),this.data.status="ok",this.data.status_txt="connected",this.rws.send('{"topic":"$ctrl", "payload":"start"}')}onClose(){console.log("WS closed"),this.data.status=this.rws?"bad":"off"}onMessage(t){let e;try{e=JSON.parse(t.data)}catch(n){return void console.log("WS rx:",n)}"object"==typeof e&&"string"==typeof e.topic&&void 0!==e.payload?(console.log("WS rx:",e),this.recvMsg(e),this.data.status="ok",this.data.status_txt="connected"):console.log("WS rx: message is missing topic and/or payload",e)}onError(t){console.log("WS rx error:",t.message||" ... no details"),this.data.status="bad",this.data.status_txt=t.message?`error: ${t.message}`:"error"}}const dt={};var ut=G({name:"Connections",components:{DemoSettings:z,WebsockSettings:Z},data:()=>({show_dialog:!1,demo_connection:null,websock_connection:null}),computed:{icon_color(){let t=0,e=0;for(const n of[this.demo_connection,this.websock_connection])if(n)switch(n.data.status){case"ok":t++;break;case"bad":e++}return t?e?"warning":"success":e?"error":"grey"},demo_config(){return this.$config.conn?this.$config.conn.demo:void 0},websock_config(){return this.$config.conn?this.$config.conn.websock:void 0}},inject:["$store","$config"],created(){console.log("Connection: created");const t=this.$config.conn;this.$set(t,"demo",{enabled:!0}),this.$set(t,"websock",{enabled:!1,address:""});const e=this.$root.params;e&&e.get("ws")&&(t.demo.enabled=!1,t.websock.address=e.get("ws"),t.websock.enabled=!0),console.log("Initial connection config:",JSON.stringify(t))},mounted(){console.log("Connection: mounted, websock_config:",this.websock_config),this.demo_connection=new K(void 0,this.handleMsg),this.demo_config&&this.demo_config.enabled&&this.demo_connection.start(),this.websock_connection=new lt(void 0,this.handleMsg),this.websock_config&&this.websock_config.enabled&&this.websock_config.address&&this.websock_connection.start(this.websock_config.address)},beforeDestroy(){console.log("Connection: beforeDestroy"),this.demo_connection&&this.demo_connection.stop(),this.websock_connection&&this.websock_connection.stop()},methods:{showDialog(t){this.show_dialog=!0,t.stopPropagation()},handleMsg(t){if("topic"in t&&"payload"in t){if("$config"===t.topic){const e=t.payload;if(console.log(`*** config for '${e.dash.title}' received:`,`${Object.keys(e.tabs).length} tabs, ${Object.keys(e.grids).length} grids,`,`${Object.keys(e.widgets).length} widgets`),this.$config.dash.title)return void console.log("Already got config, dropping message");if(!t.payload||!t.payload.dash)return console.log("*** No or broken config, clearing! (got:",t.payload),void this.$store.initDash()}this.$store.insertData(t.topic,t.payload)}else console.log("Message w/out topic/payload:",t)}}},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"mx-2"},[n(g,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var o=e.on;return[n(b,t._g({attrs:{small:"",icon:"",color:t.icon_color}},Object.assign({},{click:t.showDialog},o)),[n(_,[t._v("mdi-network")])],1)]}}])},[n("span",[t._v("Server connections")])]),n(m,{model:{value:t.show_dialog,callback:function(e){t.show_dialog=e},expression:"show_dialog"}},[n(v,[n(y,{staticClass:"d-flex"},[n("span",[t._v("Server Connections")]),n(w),n(b,{attrs:{elevation:"0",icon:""},on:{click:function(e){t.show_dialog=!1}}},[n(_,[t._v("mdi-close")])],1)],1),n(j,[n(x,{attrs:{justify:"space-between"}},[n("websock-settings",{attrs:{connection:t.websock_connection,config:t.websock_config}}),n("demo-settings",{attrs:{connection:t.demo_connection,config:t.demo_config}}),n(u,{attrs:{cols:"12",md:"5"}},[n("h3",[t._v("UIbuilder")]),t._v(" Connect to Node-Red using UIbuilder's socket.io "),n(h,{attrs:{disabled:"",label:"enabled (not yet implemented)","hide-details":""}}),n(f,{attrs:{label:"Node-Red server address","persistent-hint":"",hint:"http://localhost:1880/ws/fd"}}),n(f,{attrs:{label:"UIbuilder namespace","persistent-hint":"",hint:"URL field in the uibuilder node's properties in node-red"}})],1)],1)],1)],1)],1)],1)}),[],!1,(function(t){for(let e in dt)this[e]=dt[e]}),null,null,null);ut.options.__file="src/components/connections.vue";var ht=ut.exports;const ft={};var pt=G({name:"Dash",components:{Connections:ht},inject:["$config","$store","palette"],data:()=>({appTitle:"FlexDash",sidebar:!1,tab_ix:null,tab_edit:!1,settings_menu:null,settings:{edit:"Edit mode",theme:"Toggle theme"}}),computed:{gotConfig(){return void 0!==this.$config.dash.title},dash(){return this.gotConfig?this.$config.dash:{}},dash_tabs(){return this.dash.tabs||[]},tab(){return this.tab_id?this.tabs[this.tab_id]:{}},tab_id(){return null!=this.tab_ix?this.dash_tabs[this.tab_ix]:null},tabs(){return this.gotConfig?this.$config.tabs:{}},grids(){return this.gotConfig?this.$config.grids:{}},theme(){return this.$vuetify.theme.dark?"dark":"light"},canUndo(){return this.$store.undo.buf.length>0},_sd(){return this.$store.sd},_config(){return this.$config}},watch:{tabs(t){this.tab_ix>=t.length&&(this.tab_ix=t.length-1)}},mounted(){console.log(`FlexDash! route=${this.$root.route} params=${this.$root.params}`)},provide(){const t=this;return{sendSrv(e,n){t.$refs.uib.send({topic:e,payload:n})}}},methods:{addTab(t){const e=this.$store.addTab();t.stopPropagation(),this.$nextTick((()=>{this.tab_ix=e,this.tab_edit=!0}))},deleteTab(){this.$store.deleteTab(this.tab_ix),this.tab_ix>=this.$config.dash.tabs.length-1&&(this.tab_ix=this.$config.dash.tabs.length-1),this.tab_edit=!1},handleEdit(t,e){console.log("handleEdit",t,e);const n={};n[t]=e,this.$store.updateTab(this.tab_id,n)},moveTab(t){const e=this.tab_ix;if(!(e+t>=0&&e+t<this.dash.tabs.length))return;let n=[...this.dash.tabs],o=n[e];n[e]=n[e+t],n[e+t]=o,this.$store.updateDash({tabs:n}),this.tab_ix+=t,this.gotConfig=!1,this.$nextTick((()=>this.gotConfig=!0))},addGrid(){this.$store.addGrid(this.tab_id)},deleteGrid(t,e){this.$store.deleteGrid(t,e)}}},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n($,[t.gotConfig?n(k,{attrs:{app:"","mini-variant":"",clipped:""},model:{value:t.sidebar,callback:function(e){t.sidebar=e},expression:"sidebar"}},[n("div",[n(O,{attrs:{vertical:""},model:{value:t.tab_ix,callback:function(e){t.tab_ix=e},expression:"tab_ix"}},t._l(t.dash_tabs,(function(e){return n(E,{key:e,staticClass:"px-0",staticStyle:{"min-width":"auto"}},[n(_,{attrs:{large:""}},[t._v("mdi-"+t._s(t.tabs[e].icon))])],1)})),1)],1)]):t._e(),n(S,{attrs:{dense:"",app:"","clipped-left":"",color:"surface"}},[n("span",{staticClass:"hidden-sm-and-up"},[n(C,{on:{click:function(e){t.sidebar=!t.sidebar}}})],1),n(D,{staticClass:"text-h4 font-weight-bold text--secondary flex-shrink-0 mr-3",staticStyle:{"font-variant":"small-caps"}},[t._v(" "+t._s(t.gotConfig?t.dash.title:"FlexDash")+" ")]),t.gotConfig?n(O,{staticClass:"hidden-xs-only",attrs:{"icons-and-text":"","center-active":""},model:{value:t.tab_ix,callback:function(e){t.tab_ix=e},expression:"tab_ix"}},[t._l(t.dash_tabs,(function(e,o){return n(E,{key:e+o,class:{"is-active":o==t.tab_ix},attrs:{id:"tab-"+e,xhref:"#tab"+o}},[t._v(" "+t._s(t.tabs[e].title)+" "),n(_,{staticClass:"mb-0",attrs:{large:!t.tabs[e].title}},[t._v("mdi-"+t._s(t.tabs[e].icon))]),n("div",{staticStyle:{position:"absolute","z-index":"5",right:"0",top:"0.5ex"}},[t.$root.editMode&&o==t.tab_ix?n(b,{attrs:{small:"",icon:""},on:{click:function(e){t.tab_edit=!t.tab_edit}}},[n(_,{attrs:{small:""}},[t._v("mdi-pencil")])],1):t._e()],1)],1)})),t.$root.editMode?n(b,{staticClass:"my-auto",attrs:{"x-small":"",fab:""},on:{click:function(e){return t.addTab(e)}}},[n(_,[t._v("mdi-plus")])],1):t._e()],2):t._e(),n(w),t.$root.editMode?n(g,{attrs:{bottom:"",disabled:!t.canUndo},scopedSlots:t._u([{key:"activator",fn:function(e){var o=e.on,i=e.attrs;return[n(b,t._g(t._b({attrs:{icon:"",disabled:!t.canUndo},on:{click:function(e){return t.$store.performUndo()}}},"v-btn",i,!1),o),[n(_,[t._v("mdi-undo")])],1)]}}],null,!1,3463734905)},[n("span",[t._v("undo "+t._s(t.canUndo&&t.$store.undo.buf[t.$store.undo.buf.length-1].tagline))])]):t._e(),n("connections"),n(I,{attrs:{"offset-x":"","min-width":"10em"},scopedSlots:t._u([{key:"activator",fn:function(e){var o=e.on,i=e.attrs;return[n(b,t._g(t._b({attrs:{icon:""}},"v-btn",i,!1),o),[n(_,[t._v("mdi-cog")])],1)]}}]),model:{value:t.settings_menu,callback:function(e){t.settings_menu=e},expression:"settings_menu"}},[n(T,{attrs:{dense:""}},[n(A,[n(P,{attrs:{inset:"",label:"Edit"},model:{value:t.$root.editMode,callback:function(e){t.$set(t.$root,"editMode",e)},expression:"$root.editMode"}})],1),n(A,[n(P,{attrs:{inset:"",label:"Dark"},model:{value:t.$vuetify.theme.dark,callback:function(e){t.$set(t.$vuetify.theme,"dark",e)},expression:"$vuetify.theme.dark"}})],1)],1)],1)],1),n(I,{attrs:{"offset-y":"","allow-overflow":"",activator:"#tab-"+t.tab_id,"max-width":"30ex","content-class":"popup-spacer","close-on-content-click":!1},model:{value:t.tab_edit,callback:function(e){t.tab_edit=e},expression:"tab_edit"}},[n(v,{attrs:{color:"surface"}},[n(j,{staticClass:"d-flex px-2"},[n(g,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var o=e.on;return[n(b,t._g({attrs:{small:"",icon:""},on:{click:function(e){return t.moveTab(-1)}}},o),[n(_,[t._v("mdi-arrow-left-bold")])],1)]}}])},[n("span",[t._v("Move tab left")])]),n(g,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var o=e.on;return[n(b,t._g({attrs:{small:"",icon:""},on:{click:function(e){return t.moveTab(1)}}},o),[n(_,[t._v("mdi-arrow-right-bold")])],1)]}}])},[n("span",[t._v("Move tab right")])]),n(w),n(b,{staticClass:"mx-auto",attrs:{small:""},on:{click:t.deleteTab}},[t._v("Delete tab")]),n(w),n(b,{attrs:{small:"",elevation:"0",icon:""},on:{click:function(e){t.tab_edit=!1}}},[n(_,[t._v("mdi-close")])],1)],1),n(j,{staticClass:"d-flex flex-column"},[n(f,{staticClass:"flex-grow-0",attrs:{dense:"",label:"icon","persistent-hint":"",hint:"yes",value:t.tab.icon},on:{input:function(e){return t.handleEdit("icon",e)}},scopedSlots:t._u([{key:"message",fn:function(){return[n("span",[t._v("See "),n("a",{attrs:{target:"_blank",href:"https://materialdesignicons.com"}},[t._v(" materialdesignicons.com "),n(_,{attrs:{color:"primary","x-small":""}},[t._v("mdi-open-in-new")])],1)])]},proxy:!0}])}),n(f,{staticClass:"flex-grow-0 mt-6",attrs:{dense:"",label:"tab title",value:t.tab.title},on:{input:function(e){return t.handleEdit("title",e)}}}),n(b,{staticClass:"mx-auto",attrs:{small:""},on:{click:t.addGrid}},[t._v("Add grid")])],1)],1)],1),n(L,[t.gotConfig?n(M,{model:{value:t.tab_ix,callback:function(e){t.tab_ix=e},expression:"tab_ix"}},[n("div",{style:{backgroundColor:t.$vuetify.theme.themes[t.theme].background}},t._l(t.dash_tabs,(function(e){return n(N,{key:e,class:{"is-active":e==t.tab_id}},t._l(t.tabs[e].grids,(function(o,i){return n(t.grids[o].kind in t.palette.grids?t.grids[o].kind:"div",{key:o,tag:"component",attrs:{id:o},on:{delete:function(n){return t.deleteGrid(e,i)}}})})),1)})),1)]):n("div",[t._v(" LOADING... ")])],1)],1)}),[],!1,(function(t){for(let e in ft)this[e]=ft[e]}),null,null,null);pt.options.__file="src/dash.vue";var gt=pt.exports,bt="object"==typeof global&&global&&global.Object===Object&&global,_t="object"==typeof self&&self&&self.Object===Object&&self,mt=bt||_t||Function("return this")(),vt=mt.Symbol,yt=Object.prototype,wt=yt.hasOwnProperty,jt=yt.toString,xt=vt?vt.toStringTag:void 0;var $t=Object.prototype.toString;var kt=vt?vt.toStringTag:void 0;function Ot(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":kt&&kt in Object(t)?function(t){var e=wt.call(t,xt),n=t[xt];try{t[xt]=void 0;var o=!0}catch(s){}var i=jt.call(t);return o&&(e?t[xt]=n:delete t[xt]),i}(t):function(t){return $t.call(t)}(t)}function Et(t){return null!=t&&"object"==typeof t}var St=Array.isArray;function Ct(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Dt(t){if(!Ct(t))return!1;var e=Ot(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var It,Tt=mt["__core-js_shared__"],At=(It=/[^.]+$/.exec(Tt&&Tt.keys&&Tt.keys.IE_PROTO||""))?"Symbol(src)_1."+It:"";var Pt=Function.prototype.toString;function Lt(t){if(null!=t){try{return Pt.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var Mt=/^\[object .+?Constructor\]$/,Nt=Function.prototype,Rt=Object.prototype,Ft=Nt.toString,Ut=Rt.hasOwnProperty,Bt=RegExp("^"+Ft.call(Ut).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Gt(t){return!(!Ct(t)||(e=t,At&&At in e))&&(Dt(t)?Bt:Mt).test(Lt(t));var e}function Wt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return Gt(n)?n:void 0}var qt=Wt(mt,"WeakMap"),zt=Object.create,Vt=function(){function t(){}return function(e){if(!Ct(e))return{};if(zt)return zt(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();var Xt=function(){try{var t=Wt(Object,"defineProperty");return t({},"",{}),t}catch(e){}}();var Jt=/^(?:0|[1-9]\d*)$/;function Qt(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Jt.test(t))&&t>-1&&t%1==0&&t<e}function Kt(t,e,n){"__proto__"==e&&Xt?Xt(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Yt(t,e){return t===e||t!=t&&e!=e}var Ht=Object.prototype.hasOwnProperty;function Zt(t,e,n){var o=t[e];Ht.call(t,e)&&Yt(o,n)&&(void 0!==n||e in t)||Kt(t,e,n)}function te(t,e,n,o){var i=!n;n||(n={});for(var s=-1,r=e.length;++s<r;){var a=e[s],c=o?o(n[a],t[a],a,n,t):void 0;void 0===c&&(c=t[a]),i?Kt(n,a,c):Zt(n,a,c)}return n}function ee(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function ne(t){return null!=t&&ee(t.length)&&!Dt(t)}var oe=Object.prototype;function ie(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||oe)}function se(t){return Et(t)&&"[object Arguments]"==Ot(t)}var re=Object.prototype,ae=re.hasOwnProperty,ce=re.propertyIsEnumerable,le=se(function(){return arguments}())?se:function(t){return Et(t)&&ae.call(t,"callee")&&!ce.call(t,"callee")};var de="object"==typeof exports&&exports&&!exports.nodeType&&exports,ue=de&&"object"==typeof module&&module&&!module.nodeType&&module,he=ue&&ue.exports===de?mt.Buffer:void 0,fe=(he?he.isBuffer:void 0)||function(){return!1},pe={};function ge(t){return function(e){return t(e)}}pe["[object Float32Array]"]=pe["[object Float64Array]"]=pe["[object Int8Array]"]=pe["[object Int16Array]"]=pe["[object Int32Array]"]=pe["[object Uint8Array]"]=pe["[object Uint8ClampedArray]"]=pe["[object Uint16Array]"]=pe["[object Uint32Array]"]=!0,pe["[object Arguments]"]=pe["[object Array]"]=pe["[object ArrayBuffer]"]=pe["[object Boolean]"]=pe["[object DataView]"]=pe["[object Date]"]=pe["[object Error]"]=pe["[object Function]"]=pe["[object Map]"]=pe["[object Number]"]=pe["[object Object]"]=pe["[object RegExp]"]=pe["[object Set]"]=pe["[object String]"]=pe["[object WeakMap]"]=!1;var be="object"==typeof exports&&exports&&!exports.nodeType&&exports,_e=be&&"object"==typeof module&&module&&!module.nodeType&&module,me=_e&&_e.exports===be&&bt.process,ve=function(){try{var t=_e&&_e.require&&_e.require("util").types;return t||me&&me.binding&&me.binding("util")}catch(e){}}(),ye=ve&&ve.isTypedArray,we=ye?ge(ye):function(t){return Et(t)&&ee(t.length)&&!!pe[Ot(t)]},je=Object.prototype.hasOwnProperty;function xe(t,e){var n=St(t),o=!n&&le(t),i=!n&&!o&&fe(t),s=!n&&!o&&!i&&we(t),r=n||o||i||s,a=r?function(t,e){for(var n=-1,o=Array(t);++n<t;)o[n]=e(n);return o}(t.length,String):[],c=a.length;for(var l in t)!e&&!je.call(t,l)||r&&("length"==l||i&&("offset"==l||"parent"==l)||s&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Qt(l,c))||a.push(l);return a}function $e(t,e){return function(n){return t(e(n))}}var ke=$e(Object.keys,Object),Oe=Object.prototype.hasOwnProperty;function Ee(t){return ne(t)?xe(t):function(t){if(!ie(t))return ke(t);var e=[];for(var n in Object(t))Oe.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}var Se=Object.prototype.hasOwnProperty;function Ce(t){if(!Ct(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=ie(t),n=[];for(var o in t)("constructor"!=o||!e&&Se.call(t,o))&&n.push(o);return n}function De(t){return ne(t)?xe(t,!0):Ce(t)}var Ie=Wt(Object,"create");var Te=Object.prototype.hasOwnProperty;var Ae=Object.prototype.hasOwnProperty;function Pe(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function Le(t,e){for(var n=t.length;n--;)if(Yt(t[n][0],e))return n;return-1}Pe.prototype.clear=function(){this.__data__=Ie?Ie(null):{},this.size=0},Pe.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Pe.prototype.get=function(t){var e=this.__data__;if(Ie){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return Te.call(e,t)?e[t]:void 0},Pe.prototype.has=function(t){var e=this.__data__;return Ie?void 0!==e[t]:Ae.call(e,t)},Pe.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Ie&&void 0===e?"__lodash_hash_undefined__":e,this};var Me=Array.prototype.splice;function Ne(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}Ne.prototype.clear=function(){this.__data__=[],this.size=0},Ne.prototype.delete=function(t){var e=this.__data__,n=Le(e,t);return!(n<0)&&(n==e.length-1?e.pop():Me.call(e,n,1),--this.size,!0)},Ne.prototype.get=function(t){var e=this.__data__,n=Le(e,t);return n<0?void 0:e[n][1]},Ne.prototype.has=function(t){return Le(this.__data__,t)>-1},Ne.prototype.set=function(t,e){var n=this.__data__,o=Le(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this};var Re=Wt(mt,"Map");function Fe(t,e){var n,o,i=t.__data__;return("string"==(o=typeof(n=e))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Ue(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function Be(t,e){for(var n=-1,o=e.length,i=t.length;++n<o;)t[i+n]=e[n];return t}Ue.prototype.clear=function(){this.size=0,this.__data__={hash:new Pe,map:new(Re||Ne),string:new Pe}},Ue.prototype.delete=function(t){var e=Fe(this,t).delete(t);return this.size-=e?1:0,e},Ue.prototype.get=function(t){return Fe(this,t).get(t)},Ue.prototype.has=function(t){return Fe(this,t).has(t)},Ue.prototype.set=function(t,e){var n=Fe(this,t),o=n.size;return n.set(t,e),this.size+=n.size==o?0:1,this};var Ge=$e(Object.getPrototypeOf,Object);function We(t){var e=this.__data__=new Ne(t);this.size=e.size}We.prototype.clear=function(){this.__data__=new Ne,this.size=0},We.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},We.prototype.get=function(t){return this.__data__.get(t)},We.prototype.has=function(t){return this.__data__.has(t)},We.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Ne){var o=n.__data__;if(!Re||o.length<199)return o.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ue(o)}return n.set(t,e),this.size=n.size,this};var qe="object"==typeof exports&&exports&&!exports.nodeType&&exports,ze=qe&&"object"==typeof module&&module&&!module.nodeType&&module,Ve=ze&&ze.exports===qe?mt.Buffer:void 0,Xe=Ve?Ve.allocUnsafe:void 0;function Je(){return[]}var Qe=Object.prototype.propertyIsEnumerable,Ke=Object.getOwnPropertySymbols,Ye=Ke?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,o=null==t?0:t.length,i=0,s=[];++n<o;){var r=t[n];e(r,n,t)&&(s[i++]=r)}return s}(Ke(t),(function(e){return Qe.call(t,e)})))}:Je;var He=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)Be(e,Ye(t)),t=Ge(t);return e}:Je;function Ze(t,e,n){var o=e(t);return St(t)?o:Be(o,n(t))}function tn(t){return Ze(t,Ee,Ye)}function en(t){return Ze(t,De,He)}var nn=Wt(mt,"DataView"),on=Wt(mt,"Promise"),sn=Wt(mt,"Set"),rn=Lt(nn),an=Lt(Re),cn=Lt(on),ln=Lt(sn),dn=Lt(qt),un=Ot;(nn&&"[object DataView]"!=un(new nn(new ArrayBuffer(1)))||Re&&"[object Map]"!=un(new Re)||on&&"[object Promise]"!=un(on.resolve())||sn&&"[object Set]"!=un(new sn)||qt&&"[object WeakMap]"!=un(new qt))&&(un=function(t){var e=Ot(t),n="[object Object]"==e?t.constructor:void 0,o=n?Lt(n):"";if(o)switch(o){case rn:return"[object DataView]";case an:return"[object Map]";case cn:return"[object Promise]";case ln:return"[object Set]";case dn:return"[object WeakMap]"}return e});var hn=un,fn=Object.prototype.hasOwnProperty;var pn=mt.Uint8Array;function gn(t){var e=new t.constructor(t.byteLength);return new pn(e).set(new pn(t)),e}var bn=/\w*$/;var _n=vt?vt.prototype:void 0,mn=_n?_n.valueOf:void 0;function vn(t,e,n){var o,i,s,r=t.constructor;switch(e){case"[object ArrayBuffer]":return gn(t);case"[object Boolean]":case"[object Date]":return new r(+t);case"[object DataView]":return function(t,e){var n=e?gn(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(t,e){var n=e?gn(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(t);case"[object RegExp]":return(s=new(i=t).constructor(i.source,bn.exec(i))).lastIndex=i.lastIndex,s;case"[object Set]":return new r;case"[object Symbol]":return o=t,mn?Object(mn.call(o)):{}}}var yn=ve&&ve.isMap,wn=yn?ge(yn):function(t){return Et(t)&&"[object Map]"==hn(t)};var jn=ve&&ve.isSet,xn=jn?ge(jn):function(t){return Et(t)&&"[object Set]"==hn(t)},$n={};function kn(t,e,n,o,i,s){var r,a=1&e,c=2&e,l=4&e;if(n&&(r=i?n(t,o,i,s):n(t)),void 0!==r)return r;if(!Ct(t))return t;var d=St(t);if(d){if(r=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&fn.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!a)return function(t,e){var n=-1,o=t.length;for(e||(e=Array(o));++n<o;)e[n]=t[n];return e}(t,r)}else{var u=hn(t),h="[object Function]"==u||"[object GeneratorFunction]"==u;if(fe(t))return function(t,e){if(e)return t.slice();var n=t.length,o=Xe?Xe(n):new t.constructor(n);return t.copy(o),o}(t,a);if("[object Object]"==u||"[object Arguments]"==u||h&&!i){if(r=c||h?{}:function(t){return"function"!=typeof t.constructor||ie(t)?{}:Vt(Ge(t))}(t),!a)return c?function(t,e){return te(t,He(t),e)}(t,function(t,e){return t&&te(e,De(e),t)}(r,t)):function(t,e){return te(t,Ye(t),e)}(t,function(t,e){return t&&te(e,Ee(e),t)}(r,t))}else{if(!$n[u])return i?t:{};r=vn(t,u,a)}}s||(s=new We);var f=s.get(t);if(f)return f;s.set(t,r),xn(t)?t.forEach((function(o){r.add(kn(o,e,n,o,t,s))})):wn(t)&&t.forEach((function(o,i){r.set(i,kn(o,e,n,i,t,s))}));var p=d?void 0:(l?c?en:tn:c?De:Ee)(t);return function(t,e){for(var n=-1,o=null==t?0:t.length;++n<o&&!1!==e(t[n],n,t););}(p||t,(function(o,i){p&&(o=t[i=o]),Zt(r,i,kn(o,e,n,i,t,s))})),r}$n["[object Arguments]"]=$n["[object Array]"]=$n["[object ArrayBuffer]"]=$n["[object DataView]"]=$n["[object Boolean]"]=$n["[object Date]"]=$n["[object Float32Array]"]=$n["[object Float64Array]"]=$n["[object Int8Array]"]=$n["[object Int16Array]"]=$n["[object Int32Array]"]=$n["[object Map]"]=$n["[object Number]"]=$n["[object Object]"]=$n["[object RegExp]"]=$n["[object Set]"]=$n["[object String]"]=$n["[object Symbol]"]=$n["[object Uint8Array]"]=$n["[object Uint8ClampedArray]"]=$n["[object Uint16Array]"]=$n["[object Uint32Array]"]=!0,$n["[object Error]"]=$n["[object Function]"]=$n["[object WeakMap]"]=!1;function On(t){return kn(t,5)}class En extends Error{constructor(t){return super(t),this.name="StoreError",this}}const Sn={icon:"rocket-launch",title:"",grids:[]},Cn={kind:"fixed-grid",title:"",widgets:[]},Dn={kind:"stat",rows:1,cols:1,static:{title:"Stat"},dynamic:{}};let In=new class{constructor(){return this.root=l.observable({sd:{},$config:{dash:{},tabs:{},grids:{},widgets:{},conn:{}}}),this.sd=this.root.sd,this.config=this.root.$config,this.queue=[],this.undo=l.observable({buf:[],at:null}),this}insertData(t,e){let n=t.split("/");if(n=n.filter((t=>t.length>0)),0==n.length)throw new En("Cannot replace entire hierarchy");if("$config"===t)return Object.keys(e).forEach((t=>{l.set(this.config,t,e[t])})),void console.log("Replaced $config with:",e);"$config"!==n[0]&&n.unshift("sd");const o=n.pop(),i=function(t,e){let n=t;for(const o of e)if(""==o);else if(Array.isArray(n)){const t=parseInt(o,10);if(Number.isNaN(t))throw new En(`Array index '${o}' in '${e}' is not an int`);if(t<0||t>=n.length)throw new En(`Array index '${o}' in '${e}' > ${n.length}`);n=n[t]}else{if("object"!=typeof n)throw new En(`Level '${o}' of '${e}'' is not traversable: ${typeof n[o]}`);o in n&&void 0!==n[o]||l.set(n,o,{}),n=n[o]}return n}(this.root,n);let s;if(Array.isArray(i)){const n=parseInt(o,10);if(Number.isNaN(n))throw new En(`Array index '${o}' is not a number`);if(n>=0&&n<i.length){if(void 0===e)throw new En(`Cannot delete array element '${n}' in '${t}'`);s=i[n],l.set(i,n,e)}else{if(n!=i.length)throw new En(`Array index '${n}' in '${t}' > ${i.length}`);if(void 0===e)throw new En(`Array index '${n}' in '${t}' >= ${i.length}`);s=void 0,i.push(e)}}else{if("object"!=typeof i)throw new En(`${t} is neither Array nor Object in server state`);s=i[o],void 0!==e?l.set(i,o,e):delete i[o]}return s}pushUndo(t,e){const n=Date.now(),o=this.undo;if(o.at&&o.buf.length>0&&n-o.at<6e4&&t==o.buf[o.buf.length-1].tagline)console.log("undo coalesce"),o.buf[o.buf.length-1].mutation=[...e,...o.buf[o.buf.length-1].mutation];else for(o.at=n,o.buf.push({tagline:t,mutation:e});o.buf.length>10;)o.buf.shift()}performUndo(){console.log("perform undo");const t=this.undo;if(0==t.buf.length)throw new En("undo buffer is empty");const e=t.buf.pop();t.at=null,this.qMutation(null,e.mutation)}qMutation(t,e){console.log("queueing mutation",t);let n=[];for(const o of e)n.unshift([o[0],this.insertData("$config/"+o[0],o[1])]);t&&this.pushUndo(t,n)}genId(t,e){let n=null;for(;!n||n in t;)n="00000"+Math.floor(1e4*Math.random()),n=e+n.substring(n.length-5);return n}tabByID(t){const e=this.config.tabs[t];if(e&&e.id==t)return e;throw new En(`tab ${t} does not exist`)}gridByID(t){const e=this.config.grids[t];if(e&&e.id==t)return e;throw new En(`grid ${t} does not exist`)}widgetByID(t){const e=this.config.widgets[t];if(e&&e.id==t)return e;throw new En(`widget ${t} does not exist`)}tabIDByIX(t){const e=this.config.dash.tabs;if(e&&t>=0&&t<e.length)return e[t];throw new En(`tab #${t} does not exist`)}gridIDByIX(t,e){if("string"==typeof t&&(t=this.tabByID(t)),t&&e>=0&&e<t.grids.length)return t.grids[e];throw new En(`grid #${e} does not exist in tab ${t.id}`)}widgetIDByIX(t,e){if("string"==typeof t&&(t=this.gridByID(t)),t&&e>=0&&e<t.widgets.length)return t.widgets[e];throw new En(`widget #${e} does not exist in grid ${t.id}`)}initDash(){if(this.config.dash.title)throw new En("cannot init a non-empty store");this.insertData("$config/widgets",{}),this.insertData("$config/grids",{g00001:{id:"g00001",kind:"fixed-grid",widgets:[]}}),this.insertData("$config/tabs",{t00001:{id:"t00001",icon:"view-dashboard",grids:["g00001"]}}),this.insertData("$config/dash",{title:"FlexDash",tabs:["t00001"]})}addTab(){const t=this.genId(this.config.tabs,"t"),e=this.genId(this.config.grids,"g"),n=this.config.dash.tabs.length;return this.qMutation("add a tab",[[`grids/${e}`,c(a({},On(Cn)),{id:e})],[`tabs/${t}`,c(a({},On(Sn)),{id:t,grids:[e]})],[`dash/tabs/${n}`,t]]),n}deleteTab(t){const e=this.tabIDByIX(t),n=this.tabByID(e).grids,o=n.map((t=>this.config.grids[t].widgets)).flat();this.qMutation("delete a tab",[["dash/tabs",this.config.dash.tabs.filter(((e,n)=>n!=t))],[`tabs/${e}`,void 0],...n.map((t=>[`grids/${t}`,void 0])),...o.map((t=>[`widgets/${t}`,void 0]))])}updateTab(t,e){this.tabByID(t),this.qMutation(`update tab ${Object.keys(e).join(",")}`,Object.entries(e).map((([e,n])=>[`tabs/${t}/${e}`,n])))}updateDash(t){this.qMutation(`update dash ${Object.keys(t).join(",")}`,Object.entries(t).map((([t,e])=>[`dash/${t}`,e])))}addGrid(t){const e=this.tabByID(t),n=this.genId(this.config.grids,"g"),o=e.grids.length;return this.qMutation("add a grid",[[`grids/${n}`,c(a({},On(Cn)),{id:n})],[`tabs/${t}/grids/${o}`,n]]),o}deleteGrid(t,e){const n=this.tabByID(t),o=this.gridIDByIX(n,e),i=this.gridByID(o);this.qMutation("delete a grid",[[`tabs/${t}/grids`,n.grids.filter(((t,n)=>n!=e))],[`grids/${o}`,void 0],...i.widgets.map((t=>[`widgets/${t}`,void 0]))])}updateGrid(t,e){this.gridByID(t),this.qMutation(`update grid ${Object.keys(e).join(",")}`,Object.entries(e).map((([e,n])=>[`grids/${t}/${e}`,n])))}addWidget(t,e){const n=this.gridByID(t),o=this.genId(this.config.widgets,"w"),i=n.widgets.length;return this.qMutation("add a widget",[[`widgets/${o}`,c(a({},On(Dn)),{id:o,kind:e,static:{title:e}})],[`grids/${t}/widgets/${i}`,o]]),i}deleteWidget(t,e){const n=this.gridByID(t),o=this.widgetIDByIX(n,e);this.qMutation("delete a widget",[[`grids/${t}/widgets`,n.widgets.filter(((t,n)=>n!=e))],[`widgets/${o}`,void 0]])}updateWidget(t,e){this.widgetByID(t),this.qMutation(`update widget ${Object.keys(e).join(",")}`,Object.entries(e).map((([e,n])=>[`widgets/${t}/${e}`,n])))}updateWidgetProp(t,e,n,o){this.widgetByID(t),this.qMutation(`update widget prop ${e}:${n}`,[[`widgets/${t}/${e}/${n}`,o]])}};l.config.productionTip=!1;const Tn=l.observable({widgets:{},grids:{},count:0});function An(t,e){for(const n in e)e[n]().then((e=>{const o=e.default.name;console.log(`Loaded ${o} from ${n}`),l.component(o,e.default),l.set(t,o,e.default)})).catch((t=>{console.log(`Error glob-loading ${n}:`,t)}))}An(Tn.widgets,{"/src/widgets/gauge.vue":()=>U((()=>import("./gauge.9fb5157e.js")),["/flexdash/assets/gauge.9fb5157e.js","/flexdash/assets/gauge.491682ea.css","/flexdash/assets/vuetify.fdb6f834.js","/flexdash/assets/vuetify.1bcbcf99.css","/flexdash/assets/vue.1457ee3a.js"]),"/src/widgets/markdown.vue":()=>U((()=>import("./markdown.e1c56619.js")),["/flexdash/assets/markdown.e1c56619.js","/flexdash/assets/markdown.8af030f4.css","/flexdash/assets/vuetify.fdb6f834.js","/flexdash/assets/vuetify.1bcbcf99.css","/flexdash/assets/vue.1457ee3a.js"]),"/src/widgets/push-button.vue":()=>U((()=>import("./push-button.1c2de0cc.js")),["/flexdash/assets/push-button.1c2de0cc.js","/flexdash/assets/push-button.24fd0321.css","/flexdash/assets/vuetify.fdb6f834.js","/flexdash/assets/vuetify.1bcbcf99.css","/flexdash/assets/vue.1457ee3a.js"]),"/src/widgets/sparkchart.vue":()=>U((()=>import("./sparkchart.a073083b.js")),["/flexdash/assets/sparkchart.a073083b.js","/flexdash/assets/vuetify.fdb6f834.js","/flexdash/assets/vuetify.1bcbcf99.css","/flexdash/assets/vue.1457ee3a.js"]),"/src/widgets/stat.vue":()=>U((()=>import("./stat.ad1f303f.js")),["/flexdash/assets/stat.ad1f303f.js","/flexdash/assets/vuetify.fdb6f834.js","/flexdash/assets/vuetify.1bcbcf99.css","/flexdash/assets/vue.1457ee3a.js"]),"/src/widgets/time-plot.vue":()=>U((()=>import("./time-plot.8e04186b.js")),["/flexdash/assets/time-plot.8e04186b.js","/flexdash/assets/time-plot.82274802.css","/flexdash/assets/vue.1457ee3a.js","/flexdash/assets/vuetify.fdb6f834.js","/flexdash/assets/vuetify.1bcbcf99.css"]),"/src/widgets/toggle.vue":()=>U((()=>import("./toggle.e81a6f93.js")),["/flexdash/assets/toggle.e81a6f93.js","/flexdash/assets/vuetify.fdb6f834.js","/flexdash/assets/vuetify.1bcbcf99.css","/flexdash/assets/vue.1457ee3a.js"])}),An(Tn.grids,{"./grids/fixed-grid.vue":()=>U((()=>import("./fixed-grid.2ec1f39d.js")),["/flexdash/assets/fixed-grid.2ec1f39d.js","/flexdash/assets/fixed-grid.0f93ddd1.css","/flexdash/assets/vuetify.fdb6f834.js","/flexdash/assets/vuetify.1bcbcf99.css","/flexdash/assets/vue.1457ee3a.js"])});const Pn=new l({vuetify:B,data:{editMode:!1,route:window.location.hash,params:new URL(document.location).searchParams},provide:{$config:In.config,$store:In,palette:Tn},render:t=>t(gt)}).$mount("#app");window.addEventListener("popstate",(()=>{const t=new URL(document.location).searchParams;console.log(`POP! hash=${window.location.hash} qstring=${t}`),Pn.route=window.location.hash,Pn.params=t})),Pn.$mount("#app");export{G as n};
